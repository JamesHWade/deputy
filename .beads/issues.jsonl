{"id":"deputy-06y","title":"Stall detection only checks identical hash","description":"## Problem\nIn agent.R (lines 929-942), stall detection only warns if response is *exactly* identical to previous. An LLM could produce nearly identical but slightly different responses indefinitely.\n\n## Recommendation\nConsider fuzzy matching or detecting repeated tool call patterns.","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-10T07:38:01.013247-05:00","created_by":"james","updated_at":"2026-01-10T07:38:01.013247-05:00"}
{"id":"deputy-0d9","title":"Expand dangerous bash command patterns","description":"hook_block_dangerous_bash() has limited pattern coverage.\n\n**Current patterns:**\n- rm -rf, sudo, chmod 777, mkfs, dd if=, \u003e /dev/\n\n**Missing dangerous patterns:**\n- Fork bombs: :(){ :|: \u0026};:\n- eval and backticks\n- Command substitution $()\n- Network commands (nc, telnet, curl POST)\n- Environment manipulation\n\n**Files:**\n- R/hooks.R (lines 434-441)","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-09T07:00:17.971952-05:00","created_by":"james","updated_at":"2026-01-09T12:51:21.520071-05:00","closed_at":"2026-01-09T12:51:21.520071-05:00","close_reason":"Expanded from 6 to 50+ dangerous patterns across 8 categories. Added additional_patterns API. 35 new tests."}
{"id":"deputy-0dk","title":"Session tool restoration continues on failure","description":"## Problem\nIn agent.R (lines 390-414), when restoring tools from session fails, code logs warning and continues. Agent may be in unexpected state with missing tools.\n\n## Impact\nUser loads session expecting all tools, but some fail to restore. Subsequent tool calls fail with confusing errors.\n\n## Recommendation\nAdd boolean result field or parameter to indicate partial restoration.","status":"open","priority":3,"issue_type":"bug","created_at":"2026-01-10T07:38:18.796355-05:00","created_by":"james","updated_at":"2026-01-10T07:38:18.796355-05:00"}
{"id":"deputy-0zv","title":"Add hook timeout and multi-agent delegation tests","description":"Missing test coverage for:\n\n**Hook timeouts:**\n- Timeout behavior when callr runs hook\n- Hook callback timeout failure recovery\n\n**Multi-agent delegation:**\n- Sub-agent errors and recovery\n- Unknown agent name handling\n- Model mismatch scenarios\n- Skill loading failures in sub-agents\n\n**Files:**\n- tests/testthat/test-hooks.R\n- tests/testthat/test-agents-multi.R","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-09T06:59:52.291888-05:00","created_by":"james","updated_at":"2026-01-09T12:43:43.846958-05:00","closed_at":"2026-01-09T12:43:43.846958-05:00","close_reason":"Added 63 new tests for hook timeout behavior and multi-agent delegation edge cases. Test coverage: 433 → 496 tests."}
{"id":"deputy-1zv","title":"Bash command filtering can be bypassed via obfuscation","description":"## Problem\nThe `hook_block_dangerous_bash()` pattern-based filtering in tools-builtin.R can be bypassed through:\n\n1. Quote obfuscation: `r\"m\" -rf /`\n2. Variable substitution: `CMD=rm \u0026\u0026 $CMD -rf /`\n3. Base64 encoding: `echo \"cm0gLXJmIC8=\" | base64 -d | bash`\n4. Backslash escaping: `r\\m -rf`\n\n## Current Approach\nPattern matching against known dangerous commands (50+ patterns).\n\n## Recommendations\n- Consider a bash command parser instead of regex\n- Use whitelist approach instead of blacklist\n- Document the security limitations clearly\n- Consider sandboxed execution environments (Docker)","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-10T07:34:48.287414-05:00","created_by":"james","updated_at":"2026-01-10T07:45:15.259424-05:00","closed_at":"2026-01-10T07:45:15.259424-05:00","close_reason":"Implemented TOCTOU mitigation with atomic path validation functions and comprehensive bash obfuscation detection patterns. Added 37 new tests."}
{"id":"deputy-2yc","title":"Add active bindings to R6 classes for field protection","description":"## Problem\nSecurity-critical R6 classes (Agent, Permissions, HookMatcher) expose mutable public fields.\n\n## Affected Classes\n- **Permissions**: mode, file_write, bash, r_code can all be mutated\n- **Agent**: chat, permissions, hooks, working_dir exposed\n- **HookMatcher**: event, callback, pattern mutable after construction\n\n## Recommendations\n1. Use active bindings for controlled access to security fields\n2. Add freeze() pattern to lock down after construction\n3. Make fields read-only after initialization\n4. Consider S7 migration for value types (HookResult, PermissionResult)","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-10T07:38:19.034827-05:00","created_by":"james","updated_at":"2026-01-10T07:38:19.034827-05:00"}
{"id":"deputy-30p","title":"Add extensible tool registration API","description":"Provide a clean API for users to register custom tools from various sources: functions, R packages, external services. Should support tool annotations, validation, and conflict detection.","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-10T08:18:12.586955-05:00","created_by":"james","updated_at":"2026-01-10T08:18:12.586955-05:00"}
{"id":"deputy-37m","title":"Add AskUserQuestion tool for human-in-the-loop","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-10T08:15:04.599217-05:00","created_by":"james","updated_at":"2026-01-10T08:18:28.208234-05:00","closed_at":"2026-01-10T08:18:28.208234-05:00","close_reason":"Implemented tool_ask_user with text/choice/confirm modes and callback support"}
{"id":"deputy-391","title":"Add tests for session tool restoration paths","description":"## Problem\nSession load/save tests don't cover tool restoration paths:\n- Tools successfully restored\n- Tools fail to restore (warning issued)\n- Session has old format with only tool_names\n\n## Files\n- test-agent.R (lines 390-414 in agent.R need coverage)","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-10T07:39:02.075695-05:00","created_by":"james","updated_at":"2026-01-10T07:39:02.075695-05:00"}
{"id":"deputy-3hg","title":"Add MCP (Model Context Protocol) server support","description":"Enable deputy agents to use MCP servers for tool discovery and execution. MCP allows dynamic tool registration from external services.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-10T08:18:12.267053-05:00","created_by":"james","updated_at":"2026-01-10T15:08:15.365751-05:00","closed_at":"2026-01-10T15:08:15.365751-05:00","close_reason":"Implemented MCP server support with tools_mcp(), Agent$load_mcp(), and CLI flags"}
{"id":"deputy-49a","title":"Add agent loop integration tests with mocked tool calls","description":"## Problem\nThe agent execution loop (agent.R lines 110-172, 793-1003) has limited integration testing. Individual components are tested but not the full execution flow.\n\n## Missing Tests\n- `run_sync()` correctly accumulates events from generator\n- Streaming loop in `create_run_generator()`\n- Hooks fired during run loop (SessionStart, UserPromptSubmit, Stop, SessionEnd)\n- Stall detection logic (lines 930-942)\n- Cost limit warning at 90% (lines 856-862)\n\n## Recommended Tests\n```r\ntest_that(\"run_sync fires SessionStart hook before first turn\", {...})\ntest_that(\"run_sync respects cost limit and stops\", {...})\ntest_that(\"run_sync detects stalled responses\", {...})\n```\n\n## Notes\nMay need to enhance mock_chat to simulate tool call responses.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T07:35:14.385258-05:00","created_by":"james","updated_at":"2026-01-11T19:40:11.992015-05:00","closed_at":"2026-01-11T19:40:11.992015-05:00","close_reason":"Added integration tests for agent loop: run_sync event accumulation, SessionStart/Stop/SessionEnd hooks, cost limit warning, and stall detection. Also fixed S7 class inherits() bug that was preventing tool execution."}
{"id":"deputy-5kv","title":"Add built-in web tools (fetch and search)","description":"Add built-in tools for web operations: fetching URL content and performing web searches. Enables agents to access external information and research topics.","acceptance_criteria":"- [ ] Add `tool_web_fetch(url)` - fetch and parse web page content\n- [ ] Add `tool_web_search(query)` - perform web search and return results\n- [ ] Handle HTML to text/markdown conversion\n- [ ] Respect robots.txt and rate limiting\n- [ ] Add to tools_web() bundle\n- [ ] Requires 'web' permission in Permissions\n- [ ] Add tests for web tools\n- [ ] Update README with web tools documentation\n- [ ] Update pkgdown reference documentation","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-09T21:12:24.037337-05:00","created_by":"james","updated_at":"2026-01-11T08:12:28.072831-05:00","closed_at":"2026-01-11T08:12:28.072831-05:00","close_reason":"Implemented tool_web_fetch and tool_web_search with tests"}
{"id":"deputy-6f1","title":"Add SessionStart and SessionEnd hooks","description":"Add lifecycle hooks that fire when an agent session starts and ends. Enables setup/teardown logic, logging, metrics collection, and resource management.","acceptance_criteria":"- [ ] Add SessionStart hook event type\n- [ ] Add SessionEnd hook event type  \n- [ ] SessionStart fires before first turn begins\n- [ ] SessionEnd fires after agent stops (for any reason)\n- [ ] Hook receives context: agent info, permissions, working_dir\n- [ ] SessionEnd receives: stop_reason, total_turns, cost\n- [ ] Add tests for session lifecycle hooks\n- [ ] Update README with session hooks documentation\n- [ ] Update pkgdown reference documentation","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-09T21:12:22.984229-05:00","created_by":"james","updated_at":"2026-01-09T21:59:41.979276-05:00","closed_at":"2026-01-09T21:59:41.979276-05:00","close_reason":"Implemented SessionStart and SessionEnd hooks with full context support"}
{"id":"deputy-6jp","title":"Add session forking support","description":"Allow forking an existing agent session to create independent branches of conversation. Useful for exploring multiple solution paths from the same starting point without affecting the original session.","acceptance_criteria":"- [ ] Add `fork_session()` method to Agent class\n- [ ] Forked agent inherits conversation history, tools, permissions\n- [ ] Forked agent operates independently (changes don't affect parent)\n- [ ] Support optional new working directory for fork\n- [ ] Add tests for session forking\n- [ ] Update README with forking documentation\n- [ ] Update pkgdown reference documentation","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-09T21:12:21.998105-05:00","created_by":"james","updated_at":"2026-01-09T21:18:03.350461-05:00"}
{"id":"deputy-6k6","title":"Review implementation parity with claude-agent-sdk","description":"Compare deputy implementation against claude-agent-sdk (Python) to ensure feature parity and identify gaps.\n\n**Areas to review:**\n\n1. **Hook System**\n   - Event types (PreToolUse, PostToolUse, Stop, UserPromptSubmit, PreCompact)\n   - Hook result types and fields\n   - Hook matching patterns\n\n2. **Permission System**\n   - Permission modes (default, acceptEdits, readonly, bypassPermissions)\n   - Permission callbacks\n   - Tool annotation support\n\n3. **Agent Execution**\n   - Streaming vs batch execution\n   - Turn limits, cost limits\n   - Interruption handling\n\n4. **Multi-Agent**\n   - Agent definitions\n   - Delegation patterns\n   - Model inheritance\n\n5. **Missing Features**\n   - Any SDK features not yet in deputy\n   - API differences that may cause confusion\n\n**Repository:** https://github.com/anthropics/claude-agent-sdk","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T07:04:23.188389-05:00","created_by":"james","updated_at":"2026-01-09T11:08:10.204448-05:00","closed_at":"2026-01-09T11:08:10.204448-05:00","close_reason":"## Implementation Parity Review: deputy vs claude-code-sdk-python\n\n### Architecture Difference\n\n| Aspect | claude-code-sdk-python | deputy |\n|--------|----------------------|--------|\n| **Core** | Wraps Claude Code CLI (subprocess) | Wraps ellmer (R library) |\n| **Communication** | JSON over stdio | Direct R function calls |\n| **Async model** | Python async/await | coro generators |\n\nThe SDK is a CLI wrapper; deputy is a library wrapper. Different approaches, both valid.\n\n---\n\n### Hook System Comparison\n\n**Hook Events:**\n| Event | SDK | deputy | Notes |\n|-------|-----|--------|-------|\n| PreToolUse | ✅ | ✅ | |\n| PostToolUse | ✅ | ✅ | |\n| UserPromptSubmit | ✅ | ✅ | |\n| Stop | ✅ | ✅ | |\n| PreCompact | ✅ | ✅ | |\n| **SubagentStop** | ✅ | ❌ | **GAP** - fires when sub-agent completes |\n\n**Hook Capabilities:**\n| Feature | SDK | deputy | Notes |\n|---------|-----|--------|-------|\n| Allow/deny tools | ✅ | ✅ | |\n| **Input modification** | ✅ | ❌ | **GAP** - SDK can return `updatedInput` |\n| **System message injection** | ✅ | ❌ | **GAP** - SDK can return `systemMessage` |\n| **Output suppression** | ✅ | ❌ | **GAP** - SDK has `suppressOutput` |\n| Timeout support | ✅ | ✅ | deputy uses callr |\n| Pattern matching | ✅ | ✅ | Both use regex |\n\n---\n\n### Permission System Comparison\n\n**Permission Modes:**\n| Mode | SDK | deputy | Notes |\n|------|-----|--------|-------|\n| default | ✅ | ✅ | |\n| acceptEdits | ✅ | ✅ | |\n| bypassPermissions | ✅ | ✅ | |\n| **plan** | ✅ | ❌ | SDK-only mode for planning |\n| **readonly** | ❌ | ✅ | deputy-only mode |\n\n**Permission Features:**\n| Feature | SDK | deputy | Notes |\n|---------|-----|--------|-------|\n| can_use_tool callback | ✅ | ✅ | |\n| PermissionResultAllow/Deny | ✅ | ✅ | |\n| **Dynamic permission updates** | ✅ | ❌ | **GAP** - SDK has PermissionUpdate |\n| Fine-grained controls | Limited | ✅ | deputy has file_read, file_write, bash, r_code, web |\n| Tool annotations | Implicit | ✅ | deputy uses read_only_hint, destructive_hint |\n| Cost limits | ✅ | ✅ | max_cost_usd |\n| Turn limits | ✅ | ✅ | max_turns |\n\n---\n\n### Multi-Agent Comparison\n\n| Feature | SDK | deputy |\n|---------|-----|--------|\n| Agent definitions | ✅ AgentDefinition | ✅ agent_definition() |\n| Delegation mechanism | Via options | Via delegate_to_agent tool |\n| Model inheritance | ✅ | ✅ |\n| Sub-agent tools | ✅ | ✅ |\n| Sub-agent permissions | Inherited | Inherited |\n\n**deputy's approach is more explicit** - uses a tool for delegation that the LLM must call, rather than SDK's config-based approach.\n\n---\n\n### Features deputy Has That SDK Doesn't Emphasize\n\n1. **R code sandbox** - callr-based isolation for tool_run_r_code\n2. **Hook timeout via callr** - Enforced timeouts in subprocess\n3. **readonly mode** - Explicit read-only permission mode\n4. **Tool annotation handling** - Detailed read_only_hint, destructive_hint, open_world_hint\n5. **LLM-based compaction** - Uses LLM to summarize compacted turns\n6. **Skill system** - SKILL.yaml + SKILL.md loading\n\n---\n\n### Gaps to Consider Addressing\n\n**Priority 1 - Important:**\n| Gap | Description | Effort |\n|-----|-------------|--------|\n| SubagentStop hook | Fire hook when sub-agent completes | Low |\n| Input modification | Allow PreToolUse hooks to modify tool_input | Medium |\n\n**Priority 2 - Nice to Have:**\n| Gap | Description | Effort |\n|-----|-------------|--------|\n| System message injection | Hooks can inject messages into conversation | Medium |\n| Dynamic permission updates | Modify permissions mid-conversation | Medium |\n| Session forking | Branch conversation state | High |\n\n**Not Needed:**\n- plan mode (deputy's readonly + hooks serve similar purpose)\n- Output suppression (not critical for R use cases)\n\n---\n\n### Recommendations\n\n1. **Add SubagentStop hook event** - Easy win, useful for logging/metrics\n2. **Consider input modification** - Useful but adds complexity\n3. **Keep current permission approach** - deputy's fine-grained controls are actually more powerful\n4. **Don't chase full parity** - Different architectures, different strengths\n\ndeputy has feature parity where it matters, with some R-specific improvements (sandboxing, hooks). The SDK has some nice-to-haves (input modification, message injection) that could be added later if needed."}
{"id":"deputy-6yl","title":"Improve error handling with structured error types","description":"Implement a structured error type hierarchy for better error handling and debugging. Currently errors may be generic; structured types enable programmatic error handling and better diagnostics.","acceptance_criteria":"- [ ] Create DeputyError base class with common fields\n- [ ] Add PermissionDeniedError for permission failures\n- [ ] Add ToolExecutionError for tool failures (with tool name, input)\n- [ ] Add BudgetExceededError for cost limit violations\n- [ ] Add TurnLimitError for max_turns exceeded\n- [ ] Add ProviderError for LLM API failures\n- [ ] Include context in errors: agent state, last tool, etc.\n- [ ] Add tests for error types\n- [ ] Update README with error handling documentation\n- [ ] Update pkgdown reference documentation","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-09T21:12:24.38301-05:00","created_by":"james","updated_at":"2026-01-09T22:22:13.947885-05:00","closed_at":"2026-01-09T22:22:13.947885-05:00","close_reason":"Implemented structured error types with cli formatting"}
{"id":"deputy-7dv","title":"Hook timeout only enforced when callr installed","description":"## Problem\nIn hooks.R (lines 488-496), hook callbacks with `timeout \u003e 0` are only executed with timeout if callr is installed. Otherwise hooks run without timeout protection.\n\n## Current Code\n```r\nif (hook$timeout \u003e 0 \u0026\u0026 rlang::is_installed(\"callr\")) {\n  callr::r(..., timeout = hook$timeout)\n} else {\n  do.call(hook$callback, args)  # No timeout!\n}\n```\n\n## Impact\n- Hooks could run indefinitely if callr not installed\n- Hooks in subprocess cannot access/modify parent agent's state\n- Closures may not serialize correctly\n\n## Recommendations\n1. Require callr for timeout enforcement (add to Imports)\n2. Document that hooks with timeout run in isolation\n3. Consider alternative timeout mechanisms","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-10T07:35:53.642663-05:00","created_by":"james","updated_at":"2026-01-10T08:03:11.074706-05:00","closed_at":"2026-01-10T08:03:11.074706-05:00","close_reason":"Warns once when callr not installed but timeout requested"}
{"id":"deputy-7jd","title":"Improve documentation for hooks and tool annotations","description":"Several documentation gaps identified:\n\n**Hook context:**\n- Document what's in the context parameter for each hook type\n- Add examples showing context structure\n\n**Tool annotations:**\n- Central documentation of all available annotations\n- read_only_hint, destructive_hint, open_world_hint\n- Default values and effects\n\n**Compaction:**\n- Document how summaries are generated\n- PreCompact hook timing clarification\n\n**Files:**\n- R/hooks.R\n- R/permissions.R\n- R/agent.R\n- man/*.Rd","status":"closed","priority":4,"issue_type":"task","created_at":"2026-01-09T07:00:33.585111-05:00","created_by":"james","updated_at":"2026-01-09T12:54:35.136671-05:00","closed_at":"2026-01-09T12:54:35.136671-05:00","close_reason":"Added comprehensive documentation for hooks (callback signatures, context structure, all 6 events) and tool annotations (read_only_hint, destructive_hint, open_world_hint, idempotent_hint with examples)"}
{"id":"deputy-7y1","title":"Add test for compact with LLM summarization","description":"## Problem\nThe compact() method (lines 463-522) has basic tests, but the LLM-based summarization path (generate_compaction_summary, lines 1032-1142) is not tested. Only fallback path tested.\n\n## Recommendation\nAdd tests that mock the LLM summarization path.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-10T07:39:09.892632-05:00","created_by":"james","updated_at":"2026-01-10T07:39:09.892632-05:00"}
{"id":"deputy-8sc","title":"Validate regex pattern at HookMatcher construction","description":"## Problem\nHookMatcher accepts pattern but doesn't validate it's valid regex until match time.\n\n## Impact\nInvalid regex would fail at match time, not construction.\n\n## Recommendation\nValidate at construction with `tryCatch(grepl(pattern, \"test\"))`.","status":"open","priority":4,"issue_type":"feature","created_at":"2026-01-10T07:38:32.951758-05:00","created_by":"james","updated_at":"2026-01-10T07:38:32.951758-05:00"}
{"id":"deputy-90o","title":"Validate skill provider requirements","description":"Skills can specify provider requirements in SKILL.yaml but these aren't validated.\n\n**Current:**\n- Only package requirements are checked (lines 71-77 in skills.R)\n\n**Expected:**\n- Validate that required providers (openai, anthropic, etc.) are available\n- Warn or error if skill is loaded without required provider\n\n**Files:**\n- R/skills.R","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-09T07:00:00.99337-05:00","created_by":"james","updated_at":"2026-01-09T12:47:40.963738-05:00","closed_at":"2026-01-09T12:47:40.963738-05:00","close_reason":"Added provider requirements validation with normalize_provider_name helper. Supports 10+ providers with aliases. 41 new tests."}
{"id":"deputy-9v4","title":"Add dynamic permission mode switching","description":"Allow changing the permission mode dynamically during agent execution. Currently permissions are fixed at agent creation. This enables workflows where permissions can be relaxed or tightened based on context (e.g., after user confirmation).","acceptance_criteria":"- [ ] Add `set_permission_mode(mode)` method to Agent class\n- [ ] Support switching between: default, acceptEdits, readonly, bypassPermissions\n- [ ] Mode changes take effect for subsequent tool calls\n- [ ] Add `get_permission_mode()` method to query current mode\n- [ ] Emit event when permission mode changes\n- [ ] Add tests for dynamic permission switching\n- [ ] Update README with dynamic permissions documentation\n- [ ] Update pkgdown reference documentation","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-09T21:12:22.330075-05:00","created_by":"james","updated_at":"2026-01-09T21:18:05.660494-05:00"}
{"id":"deputy-a4p","title":"cost() uses na.rm=TRUE without alerting","description":"## Problem\nIn agent.R (lines 247-255), cost() uses na.rm=TRUE when summing, silently ignoring turns without cost info.\n\n## Impact\nCost limits might be inaccurate. Users might exceed intended budget.\n\n## Recommendation\nWarn if any NA values are present.","status":"open","priority":4,"issue_type":"bug","created_at":"2026-01-10T07:38:48.679832-05:00","created_by":"james","updated_at":"2026-01-10T07:38:48.679832-05:00"}
{"id":"deputy-aed","title":"Extract tool data returns 'unknown' placeholder on failure","description":"## Problem\nIn agent.R (lines 630-790), `extract_tool_request_data` returns fallback values like `tool_name = \"unknown\"` when extraction fails.\n\n## Impact\n- Hook patterns like `\"^run_bash$\"` won't match when they should\n- Permission checks may allow/deny wrong tools\n- PostToolUse hooks receive meaningless context\n\n## Recommendation\nConsider denying tool execution when name cannot be extracted (fail-safe) rather than continuing with placeholder.","status":"open","priority":3,"issue_type":"bug","created_at":"2026-01-10T07:38:18.56236-05:00","created_by":"james","updated_at":"2026-01-10T07:38:18.56236-05:00"}
{"id":"deputy-alv","title":"Consider hook input modification support","description":"Consider allowing PreToolUse hooks to modify tool inputs before execution.\n\n**From SDK parity review:**\nclaude-code-sdk-python allows hooks to return `updatedInput` which modifies the tool arguments.\n\n**Use cases:**\n- Sanitizing paths before file operations\n- Adding default values to tool arguments\n- Transforming inputs for security/compatibility\n\n**Considerations:**\n- Adds complexity to hook system\n- ellmer may not support tool input modification easily\n- May require changes to on_tool_request callback pattern\n\n**Decision needed:**\n- Is this worth the complexity for R use cases?\n- Would require checking if ellmer supports this\n\n**Priority 4** - Nice to have, not critical","status":"closed","priority":4,"issue_type":"feature","created_at":"2026-01-09T11:08:47.738884-05:00","created_by":"james","updated_at":"2026-01-09T12:55:51.321899-05:00","closed_at":"2026-01-09T12:55:51.321899-05:00","close_reason":"Not implementing - ellmer's on_tool_request callback only supports allow/deny via tool_reject(). No mechanism to return modified tool inputs exists. Would require upstream changes to ellmer to support this pattern. Feature deferred until ellmer adds this capability."}
{"id":"deputy-bdn","title":"Add SubagentStop hook event","description":"Add a SubagentStop hook event that fires when a sub-agent completes its task.\n\n**From SDK parity review:**\nclaude-code-sdk-python has this event for when sub-agents finish. Useful for:\n- Logging/metrics on sub-agent execution\n- Post-processing sub-agent results\n- Chaining sub-agent workflows\n\n**Implementation:**\n- Add \"SubagentStop\" to HookEvent vector in hooks.R\n- Add HookResultSubagentStop function\n- Fire hook in LeadAgent's delegate tool after sub_agent$run_sync() returns\n\n**Files:**\n- R/hooks.R\n- R/agents-multi.R","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-09T11:08:44.705748-05:00","created_by":"james","updated_at":"2026-01-09T12:12:52.392773-05:00","closed_at":"2026-01-09T12:12:52.392773-05:00","close_reason":"Added SubagentStop hook event, HookResultSubagentStop, and integration with LeadAgent delegate tool. Added 3 tests."}
{"id":"deputy-bk5","title":"Mutable public fields in Permissions class allow security bypass","description":"## Problem\nAll permission fields in the Permissions class are public and mutable. An adversarial tool callback could do:\n\n```r\ncontext$agent$permissions$mode \u003c- \"bypassPermissions\"\n```\n\nThis completely bypasses the intended security restrictions.\n\n## Affected Fields\n- `mode` - can be changed to \"bypassPermissions\"\n- `file_write` - can be set to TRUE\n- `bash` - can be enabled\n- `r_code` - can be enabled\n- All other permission fields\n\n## Recommendations\n1. Use R6 active bindings for controlled access\n2. Add a `freeze()` method called after Agent construction\n3. Make fields read-only after initialization\n4. Consider a clone() method that returns frozen copy for sub-agents","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-10T07:34:48.53178-05:00","created_by":"james","updated_at":"2026-01-10T07:52:53.68171-05:00","closed_at":"2026-01-10T07:52:53.68171-05:00","close_reason":"Implemented immutable permissions using R6 active bindings. All fields now reject modification after construction with clear error messages. Added 8 tests."}
{"id":"deputy-bki","title":"Fix TOCTOU race condition in path security checks","description":"## Problem\nThe `is_path_within()` function in utils.R (lines 83-87) has a documented but unmitigated TOCTOU (Time-Of-Check-Time-Of-Use) race condition.\n\nAn attacker could:\n1. Pass a safe path that passes the check\n2. Replace it with a symlink to a sensitive location between check and file operation\n3. The file operation would then access the sensitive location\n\n## Current Code\n```r\n#' **Security Note:** This function is subject to TOCTOU (time-of-check-time-of-use)\n#' race conditions. The filesystem state may change between the check and actual\n#' file operations.\n```\n\n## Recommendations\n- Perform permission check immediately before file operation in same atomic function\n- Use file locking where possible\n- Re-check path after opening file descriptor","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-10T07:34:48.031494-05:00","created_by":"james","updated_at":"2026-01-10T07:45:15.251383-05:00","closed_at":"2026-01-10T07:45:15.251383-05:00","close_reason":"Implemented TOCTOU mitigation with atomic path validation functions and comprehensive bash obfuscation detection patterns. Added 37 new tests."}
{"id":"deputy-cfg","title":"Sub-agent creation falls back to OpenAI without consent","description":"## Problem\nIn agents-multi.R (lines 318-338), when inheriting the model from a parent agent fails, the code falls back to `ellmer::chat_openai()` without user consent.\n\n## Impact\n- Users using Anthropic might suddenly use OpenAI (and their credits)\n- Confusing \"OPENAI_API_KEY not set\" errors when user expected Anthropic\n- Unexpected API costs\n\n## Current Code\n```r\nerror = function(e) {\n  cli_warn(c(\"Could not inherit model from parent\", \"i\" = \"Using default model\"))\n  ellmer::chat_openai()  # Assumes OpenAI is configured!\n}\n```\n\n## Recommendations\n1. Throw an error instead of falling back to unconfigured provider\n2. Require explicit `model` in `agent_definition()` when inheritance unreliable\n3. At minimum, prominently warn which provider is being used","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-10T07:35:14.115366-05:00","created_by":"james","updated_at":"2026-01-10T08:00:56.879363-05:00","closed_at":"2026-01-10T08:00:56.879363-05:00","close_reason":"Throws informative error instead of silently falling back to OpenAI"}
{"id":"deputy-e0u","title":"Detect skill tool name conflicts","description":"When loading skills, tool name conflicts are silently overwritten.\n\n**Current:**\n- Lines 446-448 in skills.R silently overwrite tools with same name\n\n**Expected:**\n- Warn on duplicate tool names\n- Consider erroring or providing conflict resolution options\n\n**Files:**\n- R/skills.R","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-09T07:00:07.66083-05:00","created_by":"james","updated_at":"2026-01-09T12:49:14.633042-05:00","closed_at":"2026-01-09T12:49:14.633042-05:00","close_reason":"Added tool name conflict detection when loading skills. Warns on conflicts but allows override. 6 new tests."}
{"id":"deputy-e80","title":"LLM compaction fallback hides API failures","description":"## Problem\nIn agent.R (lines 1093-1139), when LLM summarization for compaction fails, code silently falls back to text-based summary.\n\n## Impact\nUsers may not realize they're getting degraded compaction quality. The fallback (truncated turn text) is significantly worse than LLM summary.\n\n## Recommendations\n1. Make failure more visible in AgentEvent\n2. Allow users to configure whether to fall back or fail\n3. Add compaction_method field to result","status":"open","priority":3,"issue_type":"bug","created_at":"2026-01-10T07:38:00.784769-05:00","created_by":"james","updated_at":"2026-01-10T07:38:00.784769-05:00"}
{"id":"deputy-emf","title":"Implement LLM-based conversation compaction","description":"The compact() method in agent.R currently uses simple text concatenation instead of LLM summarization.\n\n**Current behavior:**\n- Lines 502-504 in agent.R use basic text joining\n- Produces poor summaries that lose important context\n\n**Expected behavior:**\n- Use LLM to generate meaningful conversation summaries\n- Preserve key context and decisions from compacted turns\n\n**Files:**\n- R/agent.R (compact method)","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-09T06:59:17.427567-05:00","created_by":"james","updated_at":"2026-01-09T07:09:29.75468-05:00","closed_at":"2026-01-09T07:09:29.75468-05:00","close_reason":"Implemented LLM-based compaction with fallback"}
{"id":"deputy-fa1","title":"Validate hook callback arity based on event type","description":"## Problem\nIn HookMatcher, callbacks are only checked to be functions, not that they have correct arity for the event type.\n\n## Event Signatures\n- PreToolUse: 3 args (tool_name, tool_input, context)\n- PostToolUse: 4 args (tool_name, tool_input, tool_result, context)\n- SessionStart: 1 arg (context)\n- SessionEnd: 2 args (reason, context)\n- etc.\n\n## Recommendation\nValidate callback arity at construction time based on event type.","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-10T07:38:32.71466-05:00","created_by":"james","updated_at":"2026-01-10T07:38:32.71466-05:00"}
{"id":"deputy-gam","title":"Hook errors swallowed for non-PreToolUse events","description":"## Problem\nIn hooks.R (lines 485-512), when a hook callback fails for events other than PreToolUse, the error is logged but NULL is returned, allowing the agent to continue silently.\n\n## Impact\n- PostToolUse hooks that fail to log security events\n- Stop hooks that fail to cleanup resources\n- SessionEnd hooks that fail to save state\n- SubagentStop hooks that fail to record metrics\n\n## Current Code\n```r\nif (event == \"PreToolUse\") {\n  return(HookResultPreToolUse(permission = \"deny\", reason = paste(\"Hook error:\", e$message)))\n}\nNULL  # For all other events, errors are swallowed!\n```\n\n## Recommendations\n- Consider different handling per event type\n- Add a `strict_hooks = TRUE` option that propagates errors\n- Log more prominently for observational hooks","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-10T07:35:13.844722-05:00","created_by":"james","updated_at":"2026-01-10T07:58:15.633689-05:00","closed_at":"2026-01-10T07:58:15.633689-05:00","close_reason":"Hook errors now use prominent cli_alert_danger, include context-specific messages, and are tracked via last_errors() for programmatic inspection"}
{"id":"deputy-h71","title":"Skill tool name conflicts silently overwrite existing tools","description":"## Problem\nIn skills.R (lines 593-600), when loading a skill with conflicting tool names, only a warning is generated but tools are still overwritten.\n\n## Current Code\n```r\nconflicts \u003c- new_tool_names[new_tool_names %in% current_tool_names]\nif (length(conflicts) \u003e 0) {\n  cli_warn(c(\"Skill overwrites existing tool(s)\", ...))\n}\nself$chat$register_tools(skill$tools)  # Proceeds anyway\n```\n\n## Impact\nPreviously working tools replaced without explicit consent.\n\n## Recommendations\n1. Abort on conflicts (safer)\n2. Add option to skip conflicting tools\n3. Allow explicit conflict resolution","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-10T07:37:45.101679-05:00","created_by":"james","updated_at":"2026-01-10T08:06:51.873858-05:00","closed_at":"2026-01-10T08:06:51.873858-05:00","close_reason":"Now errors by default on conflicts; added allow_conflicts parameter"}
{"id":"deputy-hsr","title":"Add PostToolUse continue=FALSE integration test","description":"## Problem\nThe `HookResultPostToolUse(continue = FALSE)` path (lines 619-624 in agent.R) sets `private$should_stop = TRUE`, but there is no integration test verifying the agent actually stops.\n\n## Code Path\nAfter setting the flag, the agent should stop at lines 953-961 in the generator loop.\n\n## Impact\nThis is a safety mechanism that could fail silently if untested.\n\n## Recommended Test\n```r\ntest_that(\"Agent stops when PostToolUse hook returns continue=FALSE\", {\n  # Set up mock with tool call\n  # Add hook returning continue=FALSE\n  # Verify agent stops after that turn\n})\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T07:35:33.799853-05:00","created_by":"james","updated_at":"2026-01-11T13:50:28.633295-05:00","closed_at":"2026-01-11T13:50:28.633295-05:00","close_reason":"Closed"}
{"id":"deputy-ihh","title":"Add tool presets for common toolsets","description":"Provide pre-configured tool collections for common use cases. Simplifies agent setup by offering curated toolsets rather than requiring manual tool selection.","acceptance_criteria":"- [ ] Add `tools_preset(name)` function returning tool collection\n- [ ] Presets: 'minimal' (read-only), 'standard' (current default), 'full' (all tools), 'data' (data analysis)\n- [ ] Support preset names in Agent constructor tools parameter\n- [ ] Document available presets and their contents\n- [ ] Add tests for tool presets\n- [ ] Update README with presets documentation\n- [ ] Update pkgdown reference documentation","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-09T21:12:23.680665-05:00","created_by":"james","updated_at":"2026-01-10T07:25:14.361652-05:00","closed_at":"2026-01-10T07:25:14.361652-05:00","close_reason":"Implemented tool presets with 5 configurations: minimal, standard, dev, data, and full. Added ToolPresets constant, tools_preset() function, and list_presets() function with comprehensive tests."}
{"id":"deputy-nfo","title":"R code tool reports success when execution may have failed","description":"## Problem\nIn tools-builtin.R (lines 305-318), if both output and result are empty but an error occurred deep in sandboxed execution, the function returns \"Code executed successfully (no output)\" which may be misleading.\n\n## Recommendation\nCheck result structure more carefully. If result indicates error, surface it even when output/result are empty.","status":"open","priority":3,"issue_type":"bug","created_at":"2026-01-10T07:39:01.830448-05:00","created_by":"james","updated_at":"2026-01-10T07:39:01.830448-05:00"}
{"id":"deputy-nhj","title":"Add tool result type validation","description":"The on_tool_result callback has minimal validation of tool result structure.\n\n**Risk:**\n- Malformed ContentToolResult objects could crash the agent\n\n**Files:**\n- R/agent.R (on_tool_result callback, lines 602-635)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T06:59:43.864784-05:00","created_by":"james","updated_at":"2026-01-09T12:07:10.311429-05:00","closed_at":"2026-01-09T12:07:10.311429-05:00","close_reason":"Added tool request/result validation with safe extraction helpers and 5 new tests"}
{"id":"deputy-p15","title":"Add S7 Turn mock support for generator tests","description":"Current mock chat doesn't provide proper S7 Turn objects that the generator expects.\n\n**Impact:**\n- Generator tests are superficial\n- Can't validate turn event generation properly\n\n**Solution:**\n- Create sophisticated mock that returns proper ellmer Turn objects\n- Or use vcr to record/replay real API responses\n\n**Files:**\n- tests/testthat/helper-mocks.R\n- tests/testthat/test-agent-execution.R","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T06:59:26.558881-05:00","created_by":"james","updated_at":"2026-01-09T12:40:08.300874-05:00","closed_at":"2026-01-09T12:40:08.300874-05:00","close_reason":"Added S7 Turn mock support with proper ellmer constructors. All 433 tests pass."}
{"id":"deputy-sy6","title":"Examine posit-dev/btw for tool reuse opportunities","description":"Review the posit-dev/btw repository for inspiration and potential tool reuse.\n\n**Goals:**\n- Identify tools in btw that could be reused or adapted\n- Compare tool implementations and patterns\n- Evaluate if we can depend on btw directly vs copying/adapting\n- Look for patterns we're missing\n\n**Areas to examine:**\n- File operation tools\n- Code execution tools\n- Data analysis tools\n- Any R-specific tooling patterns\n\n**Repository:** https://github.com/posit-dev/btw","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T07:04:12.841644-05:00","created_by":"james","updated_at":"2026-01-09T08:04:12.604955-05:00","closed_at":"2026-01-09T08:04:12.604955-05:00","close_reason":"## btw Repository Analysis Complete\n\n### Overview\nposit-dev/btw is a tool-providing package for ellmer with 17+ specialized tools organized into categories: docs, env, eval, files, git, github, ide, pkg, search, session, web.\n\n### Key Patterns Worth Adopting\n\n1. **Rich Tool Descriptions**: btw uses detailed descriptions with \"WHEN TO USE\" sections that guide LLM tool selection. We should adopt this pattern for clarity.\n\n2. **Tool Grouping System**: `btw_tools(\"category\")` pattern is elegant. We have similar with `tools_file()` etc.\n\n3. **BtwToolResult S7 Class**: Extends ContentToolResult with structured output. Our tools return plain strings - could consider richer result types.\n\n4. **GitHub API Validation**: Sophisticated endpoint allow/block system with wildcard patterns. If we add GitHub tools, this is a good security model.\n\n### Tools We Could Adapt\n\n| btw Tool | Deputy Opportunity |\n|----------|-------------------|\n| **git tools** (via gert) | Add `tools_git()` - branch, commit, diff, log operations |\n| **documentation tools** | Add `tool_read_help()`, `tool_list_vignettes()` |\n| **environment tools** | Add `tool_inspect_object()`, `tool_list_packages()` |\n| **GitHub tools** | Add `tools_github()` with endpoint validation pattern |\n\n### What NOT to Adopt\n\n1. **No Sandboxing**: btw's `tool_r_run()` executes R directly without sandbox. We keep our callr-based sandbox - it's more secure for untrusted tasks.\n\n2. **chromote Dependency**: btw's web tool requires chromote (headless Chrome). Heavy dependency we don't need.\n\n3. **IDE Integration**: btw's IDE tools are RStudio/Positron specific. Not needed for our CLI-focused approach.\n\n### Recommendation\n\n**Don't depend on btw directly** - different security philosophies. Instead:\n- Adapt their tool description patterns (more detailed WHEN TO USE sections)\n- Consider adding git tools using gert (low effort, high value)\n- Consider documentation tools (R help system integration)\n- Keep our sandbox approach - it differentiates deputy as more secure\n\n### Priority for New Tools\n1. P3: Git tools via gert (most requested)\n2. P4: Documentation tools (help/vignettes)\n3. P4: Environment inspection tools"}
{"id":"deputy-u5r","title":"Path resolution returns original path on failure (security risk)","description":"## Problem\nIn utils.R (lines 12-52), `resolve_symlinks` returns the original path if resolution fails. This is a security concern for access control.\n\n## Current Code\n```r\nif (!file.exists(path)) {\n  return(path)  # Returns unresolved path\n}\ninfo \u003c- tryCatch(file.info(path), error = function(e) NULL)\nif (is.null(info)) {\n  return(path)  # Returns original on any failure\n}\n```\n\n## Hidden Errors\n- Permission denied on path resolution\n- Network filesystem unavailable\n- Malformed path strings\n\n## Recommendation\nReturn `NA_character_` on failure rather than original path.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-10T07:37:45.342535-05:00","created_by":"james","updated_at":"2026-01-10T08:09:31.031388-05:00","closed_at":"2026-01-10T08:09:31.031388-05:00","close_reason":"Returns NA_character_ consistently on any resolution failure"}
{"id":"deputy-uju","title":"Add PreToolUse denial integration test","description":"## Problem\nWhile test-hooks.R tests the hook system in isolation, there is no test verifying that when a PreToolUse hook returns `permission = \"deny\"`, the agent correctly calls `ellmer::tool_reject()`.\n\n## Code Path\nThe `private$on_tool_request()` (lines 555-596 in agent.R) is critical for security but only indirectly tested.\n\n## Impact\nIf permission denial doesn't correctly call `tool_reject()`, dangerous tools could execute despite hooks blocking them.\n\n## Recommended Test\n```r\ntest_that(\"Agent rejects tool when PreToolUse hook denies\", {\n  # Set up mock with tool call\n  # Add blocking hook\n  # Verify tool_reject called\n})\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T07:35:33.549672-05:00","created_by":"james","updated_at":"2026-01-11T08:34:04.482787-05:00","closed_at":"2026-01-11T08:34:04.482787-05:00","close_reason":"Closed"}
{"id":"deputy-vpy","title":"Add standalone example scripts","description":"Create standalone example scripts demonstrating common use cases. Python SDK has 19 examples; deputy should have comparable coverage to help users get started.","acceptance_criteria":"- [ ] Create examples/ directory in inst/\n- [ ] quick_start.R - basic agent usage\n- [ ] streaming_mode.R - using run() generator with events\n- [ ] custom_tools.R - creating and registering custom tools\n- [ ] hooks.R - PreToolUse, PostToolUse, Stop hooks\n- [ ] multi_agent.R - LeadAgent with delegation\n- [ ] permissions.R - permission modes and callbacks\n- [ ] skills.R - loading and using skills\n- [ ] session_management.R - save/load/compact sessions\n- [ ] data_analysis.R - data analysis workflow example\n- [ ] Update README to reference examples\n- [ ] Update pkgdown to include examples section","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-09T21:12:24.706431-05:00","created_by":"james","updated_at":"2026-01-09T21:18:20.561535-05:00"}
{"id":"deputy-w76","title":"Add LeadAgent delegation execution tests","description":"## Problem\ntest-agents-multi.R tests LeadAgent structure but does not test actual delegation execution.\n\n## Missing Tests\n- Unknown agent name handling in delegate_to_agent\n- Successful delegation with sub-agent execution\n- SubagentStop hook firing after delegation\n- Permission inheritance to sub-agents\n- Model inheritance chain\n\n## Recommended Tests\n```r\ntest_that(\"delegate_to_agent handles unknown agent name\", {...})\ntest_that(\"delegation executes sub-agent and returns result\", {...})\ntest_that(\"SubagentStop hook fires after delegation\", {...})\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T07:35:34.078995-05:00","created_by":"james","updated_at":"2026-01-11T21:58:37.142394-05:00","closed_at":"2026-01-11T21:58:37.142394-05:00","close_reason":"Added 7 integration tests for LeadAgent delegation: unknown agent rejection, available agents in error message, SubagentStop hook firing, delegation execution and result, permissions inheritance, execution failure handling, and working_dir in hook context."}
{"id":"deputy-wbx","title":"Add partial message streaming support","description":"Stream partial text chunks as the LLM generates them, rather than waiting for complete turns. Enables real-time UI updates and better perceived responsiveness for long responses.","acceptance_criteria":"- [ ] Add `include_partial_messages` parameter to run() method\n- [ ] Emit 'text_chunk' events with incremental text as it streams\n- [ ] Each chunk includes position/offset for UI rendering\n- [ ] Final 'text' event still contains complete text\n- [ ] Works with both run() generator and streaming patterns\n- [ ] Add tests for partial message streaming\n- [ ] Update README with streaming documentation\n- [ ] Update pkgdown reference documentation","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-09T21:12:23.333054-05:00","created_by":"james","updated_at":"2026-01-09T21:18:11.515823-05:00"}
{"id":"deputy-x49","title":"Add file checkpointing and rewind capability","description":"Enable agents to checkpoint file system state at specific points and rewind to previous checkpoints. Similar to Python SDK's enable_file_checkpointing and rewind_files() functionality. This allows safe experimentation with file modifications that can be rolled back.","acceptance_criteria":"- [ ] Add `enable_file_checkpointing` parameter to Agent constructor\n- [ ] Implement `checkpoint(name)` method to save current file state\n- [ ] Implement `rewind_files(checkpoint_name)` method to restore state\n- [ ] Track file modifications made by agent tools\n- [ ] Support automatic checkpointing at turn boundaries (optional)\n- [ ] Add tests for checkpoint/rewind functionality\n- [ ] Update README with checkpointing documentation\n- [ ] Update pkgdown reference documentation","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-09T21:12:21.612739-05:00","created_by":"james","updated_at":"2026-01-09T21:17:59.562154-05:00"}
{"id":"deputy-x6a","title":"normalize_provider_name silently accepts unknown providers","description":"## Problem\nIn skills.R (lines 8-46), if provider doesn't match known patterns, it returns as-is. Typos in provider names silently accepted.\n\n## Recommendation\nReturn NA_character_ or warn for unrecognized provider names.","status":"open","priority":4,"issue_type":"bug","created_at":"2026-01-10T07:38:33.191102-05:00","created_by":"james","updated_at":"2026-01-10T07:38:33.191102-05:00"}
{"id":"deputy-xom","title":"Silent fallback to non-streaming mode","description":"## Problem\nIn agent.R (lines 876-921), when streaming fails, the code falls back to non-streaming with only a warning. Users may not realize behavior has degraded.\n\n## Impact\nUsers expecting streaming text output suddenly receive block output without understanding why. Problematic for long-running operations.\n\n## Recommendation\nEmit a more prominent event (AgentEvent type \"warning\") that applications can surface to users.","status":"in_progress","priority":3,"issue_type":"bug","created_at":"2026-01-10T07:38:00.562252-05:00","created_by":"james","updated_at":"2026-01-11T22:38:27.397115-05:00"}
{"id":"deputy-z0g","title":"Improve symlink and path traversal handling","description":"Path validation has edge cases that aren't fully handled.\n\n**Issues:**\n- Relative symlinks that escape directories not blocked\n- Home directory expansion (~) could bypass restrictions\n- Symlink chains not fully resolved\n- Race conditions between check and use (TOCTOU)\n\n**Files:**\n- R/utils.R (is_path_within, has_path_traversal)\n- R/permissions.R","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T06:59:34.976206-05:00","created_by":"james","updated_at":"2026-01-09T12:10:15.47796-05:00","closed_at":"2026-01-09T12:10:15.47796-05:00","close_reason":"Improved path validation with symlink resolution, home directory expansion, null handling, and TOCTOU documentation. Added 7 new edge case tests."}
{"id":"deputy-z17","title":"Add structured output format support","description":"Support structured output formats where agent responses conform to a schema. Useful for building pipelines where agent output needs to be reliably parsed (e.g., JSON, specific data structures).","acceptance_criteria":"- [ ] Add `output_format` parameter to Agent constructor\n- [ ] Support JSON schema specification for output validation\n- [ ] Add `run_structured(task, schema)` method for one-off structured queries\n- [ ] Validate output against schema before returning\n- [ ] Return parsed structured data instead of raw text when format specified\n- [ ] Add tests for structured output\n- [ ] Update README with structured output documentation\n- [ ] Update pkgdown reference documentation","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-09T21:12:22.647772-05:00","created_by":"james","updated_at":"2026-01-09T21:18:07.656671-05:00"}
