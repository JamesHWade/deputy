<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>CLAUDE.md • deputy</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png"><link rel="icon" sizes="any" href="favicon.ico"><link rel="manifest" href="site.webmanifest"><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="CLAUDE.md"><meta property="og:image" content="https://jameshwade.github.io/deputy/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">deputy</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="articles/getting-started.html">Getting Started</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/JamesHWade/deputy/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="logo.svg" class="logo" alt=""><h1>CLAUDE.md</h1>
      <small class="dont-index">Source: <a href="https://github.com/JamesHWade/deputy/blob/main/CLAUDE.md" class="external-link"><code>CLAUDE.md</code></a></small>
    </div>

<div id="claudemd" class="section level1">

<p>This file provides guidance for AI assistants working with the deputy codebase.</p>
<div class="section level2">
<h2 id="project-overview">Project Overview<a class="anchor" aria-label="anchor" href="#project-overview"></a></h2>
<p><strong>deputy</strong> is an R package implementing Anthropic’s Claude Agent SDK patterns. It provides a provider-agnostic framework for building agentic AI workflows in R, built on the <a href="https://ellmer.tidyverse.org/" class="external-link">ellmer</a> LLM framework.</p>
<p>Key capabilities: - Multi-step AI reasoning with tool use - Fine-grained permission system with tool annotations - Hook-based lifecycle event interception - Human-in-the-loop via <code>tool_ask_user</code> - Multi-agent delegation (LeadAgent) - Session persistence - Streaming output support</p>
</div>
<div class="section level2">
<h2 id="directory-structure">Directory Structure<a class="anchor" aria-label="anchor" href="#directory-structure"></a></h2>
<pre><code>deputy/
├── R/                      # Source code (R6 classes and functions)
│   ├── agent.R             # Agent class - main agentic workflow engine
│   ├── agents-multi.R      # LeadAgent for multi-agent orchestration
│   ├── agent-result.R      # AgentResult and AgentEvent objects
│   ├── permissions.R       # Permission system and tool annotations
│   ├── hooks.R             # HookRegistry for lifecycle events
│   ├── skills.R            # Skill loading system
│   ├── tools-builtin.R     # Built-in tools (read_file, write_file, etc.)
│   ├── tools-bundles.R     # Tool presets (minimal, standard, dev, data, full)
│   ├── tools-interactive.R # tool_ask_user for human-in-the-loop
│   ├── errors.R            # Custom error hierarchy
│   └── utils.R             # Internal utilities
├── tests/testthat/         # Unit tests (testthat edition 3)
├── inst/skills/            # Built-in skills with YAML metadata
├── exec/deputy             # Terminal CLI using Rapp
├── vignettes/              # User documentation (R Markdown)
├── man/                    # Auto-generated roxygen2 docs
├── .claude/                # Claude Code environment setup
└── .github/workflows/      # CI/CD pipelines</code></pre>
</div>
<div class="section level2">
<h2 id="development-setup">Development Setup<a class="anchor" aria-label="anchor" href="#development-setup"></a></h2>
<div class="section level3">
<h3 id="remote-claude-code-web">Remote (Claude Code Web)<a class="anchor" aria-label="anchor" href="#remote-claude-code-web"></a></h3>
<p>The repository includes a SessionStart hook (<code>.claude/setup-r.sh</code>) that automatically installs R and Air when working in Claude Code web environments.</p>
</div>
<div class="section level3">
<h3 id="local">Local<a class="anchor" aria-label="anchor" href="#local"></a></h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># Install dependencies</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"devtools::install_deps(dependencies = TRUE)"</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co"># Load package for development</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"devtools::load_all()"</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="common-commands">Common Commands<a class="anchor" aria-label="anchor" href="#common-commands"></a></h2>
<div class="section level3">
<h3 id="testing">Testing<a class="anchor" aria-label="anchor" href="#testing"></a></h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># Run all tests</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"devtools::test()"</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co"># Run specific test file</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"testthat::test_file('tests/testthat/test-agent.R')"</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co"># Run tests with filter</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"devtools::test(filter = 'permissions')"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="code-quality">Code Quality<a class="anchor" aria-label="anchor" href="#code-quality"></a></h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># Check package (runs R CMD check)</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"devtools::check()"</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co"># Format code with Air</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="ex">air</span> format R/</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="co"># Generate documentation</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"devtools::document()"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="building">Building<a class="anchor" aria-label="anchor" href="#building"></a></h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># Build package</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"devtools::build()"</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co"># Install locally</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"devtools::install()"</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="code-conventions">Code Conventions<a class="anchor" aria-label="anchor" href="#code-conventions"></a></h2>
<div class="section level3">
<h3 id="style">Style<a class="anchor" aria-label="anchor" href="#style"></a></h3>
<ul><li>
<strong>Formatter</strong>: Air (configuration in <code>air.toml</code>)</li>
<li>
<strong>Documentation</strong>: roxygen2 with markdown support</li>
<li>
<strong>Classes</strong>: R6 for complex objects (Agent, Permissions, HookRegistry, Skill)</li>
<li>
<strong>Errors</strong>: Use custom error classes from <code>R/errors.R</code> (e.g., <code>deputy_error_permission_denied</code>)</li>
</ul></div>
<div class="section level3">
<h3 id="r6-class-pattern">R6 Class Pattern<a class="anchor" aria-label="anchor" href="#r6-class-pattern"></a></h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ClassName</span> <span class="op">&lt;-</span> <span class="fu">R6</span><span class="fu">::</span><span class="kw"><a href="https://r6.r-lib.org/reference/R6Class.html" class="external-link">R6Class</a></span><span class="op">(</span></span>
<span>  <span class="st">"ClassName"</span>,</span>
<span>  public <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    field <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span></span>
<span>    initialize <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">param</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="co"># Validation</span></span>
<span>      <span class="co"># Assignment</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="va">self</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span></span>
<span>    method <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="co"># Implementation</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span>,</span>
<span>  private <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    helper <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="co"># Private helper</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="tool-creation-pattern">Tool Creation Pattern<a class="anchor" aria-label="anchor" href="#tool-creation-pattern"></a></h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Tool description</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">tool_name</span> <span class="op">&lt;-</span> <span class="fu">ellmer</span><span class="fu">::</span><span class="fu"><a href="https://ellmer.tidyverse.org/reference/tool.html" class="external-link">tool</a></span><span class="op">(</span></span>
<span>  fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">param</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Implementation</span></span>
<span>  <span class="op">}</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"tool_name"</span>,</span>
<span>  description <span class="op">=</span> <span class="st">"What this tool does"</span>,</span>
<span>  arguments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    param <span class="op">=</span> <span class="fu">ellmer</span><span class="fu">::</span><span class="fu"><a href="https://ellmer.tidyverse.org/reference/type_boolean.html" class="external-link">type_string</a></span><span class="op">(</span><span class="st">"Parameter description"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  annotations <span class="op">=</span> <span class="fu">ellmer</span><span class="fu">::</span><span class="fu"><a href="https://ellmer.tidyverse.org/reference/tool_annotations.html" class="external-link">tool_annotations</a></span><span class="op">(</span></span>
<span>    read_only_hint <span class="op">=</span> <span class="cn">TRUE</span>,      <span class="co"># Doesn't modify state</span></span>
<span>    destructive_hint <span class="op">=</span> <span class="cn">FALSE</span>,   <span class="co"># Not destructive</span></span>
<span>    open_world_hint <span class="op">=</span> <span class="cn">FALSE</span>,    <span class="co"># No external systems</span></span>
<span>    idempotent_hint <span class="op">=</span> <span class="cn">TRUE</span>      <span class="co"># Safe to retry</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="error-handling">Error Handling<a class="anchor" aria-label="anchor" href="#error-handling"></a></h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use custom error constructors</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="fu">deputy_error_permission_denied</span><span class="op">(</span></span>
<span>  tool_name <span class="op">=</span> <span class="st">"write_file"</span>,</span>
<span>  reason <span class="op">=</span> <span class="st">"Write operations not allowed in readonly mode"</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Catching errors</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span></span>
<span>  <span class="va">agent</span><span class="op">$</span><span class="fu">run_sync</span><span class="op">(</span><span class="va">task</span><span class="op">)</span>,</span>
<span>  deputy_error_permission_denied <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">cli</span><span class="fu">::</span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_alert.html" class="external-link">cli_alert_danger</a></span><span class="op">(</span><span class="st">"Permission denied: {e$message}"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="testing-pattern">Testing Pattern<a class="anchor" aria-label="anchor" href="#testing-pattern"></a></h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">test_that</span><span class="op">(</span><span class="st">"descriptive test name"</span>, <span class="op">{</span></span>
<span>  <span class="co"># Setup - use mocks from helper-mocks.R</span></span>
<span>  <span class="va">mock_chat</span> <span class="op">&lt;-</span> <span class="fu">create_mock_chat</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">agent</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/Agent.html">Agent</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>chat <span class="op">=</span> <span class="va">mock_chat</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Exercise</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="va">agent</span><span class="op">$</span><span class="fu">run_sync</span><span class="op">(</span><span class="st">"task"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Verify</span></span>
<span></span>
<span>  <span class="fu">expect_s3_class</span><span class="op">(</span><span class="va">result</span>, <span class="st">"AgentResult"</span><span class="op">)</span></span>
<span>  <span class="fu">expect_equal</span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">stop_reason</span>, <span class="st">"end_turn"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="architecture">Architecture<a class="anchor" aria-label="anchor" href="#architecture"></a></h2>
<div class="section level3">
<h3 id="core-flow">Core Flow<a class="anchor" aria-label="anchor" href="#core-flow"></a></h3>
<ol style="list-style-type: decimal"><li>
<strong>Agent</strong> wraps an ellmer Chat object</li>
<li>User calls <code>agent$run(task)</code> (streaming) or <code>agent$run_sync(task)</code> (blocking)</li>
<li>Agent sends task to LLM via ellmer</li>
<li>LLM may request tool calls</li>
<li>
<strong>Permissions</strong> check tool annotations and policy</li>
<li>
<strong>HookRegistry</strong> fires PreToolUse/PostToolUse events</li>
<li>Tool executes and returns result</li>
<li>Loop continues until LLM stops or limits reached</li>
</ol></div>
<div class="section level3">
<h3 id="permission-modes">Permission Modes<a class="anchor" aria-label="anchor" href="#permission-modes"></a></h3>
<ul><li>
<code>"default"</code> - Check each tool against policy</li>
<li>
<code>"readonly"</code> - Only allow read_only_hint tools</li>
<li>
<code>"acceptEdits"</code> - Auto-accept file writes</li>
<li>
<code>"bypassPermissions"</code> - Allow everything (dangerous)</li>
</ul></div>
<div class="section level3">
<h3 id="tool-presets">Tool Presets<a class="anchor" aria-label="anchor" href="#tool-presets"></a></h3>
<ul><li>
<code>tools_preset("minimal")</code> - read_file, list_files</li>
<li>
<code>tools_preset("standard")</code> - + write_file, run_r_code</li>
<li>
<code>tools_preset("dev")</code> - + run_bash</li>
<li>
<code>tools_preset("data")</code> - read_file, list_files, read_csv, run_r_code</li>
<li>
<code>tools_preset("full")</code> - all built-in tools</li>
</ul></div>
<div class="section level3">
<h3 id="hook-events">Hook Events<a class="anchor" aria-label="anchor" href="#hook-events"></a></h3>
<ul><li>
<code>PreToolUse</code> / <code>PostToolUse</code> - Before/after tool execution</li>
<li>
<code>Stop</code> - When agent finishes</li>
<li>
<code>SessionStart</code> / <code>SessionEnd</code> - Session lifecycle</li>
<li>
<code>PreCompact</code> - Before conversation compaction</li>
<li>
<code>SubagentStop</code> - When delegated agent finishes</li>
<li>
<code>UserPromptSubmit</code> - When user submits input (CLI)</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="key-files-for-understanding">Key Files for Understanding<a class="anchor" aria-label="anchor" href="#key-files-for-understanding"></a></h2>
<table class="table"><thead><tr class="header"><th>File</th>
<th>Purpose</th>
</tr></thead><tbody><tr class="odd"><td><code>R/agent.R</code></td>
<td>Main Agent class with run/run_sync</td>
</tr><tr class="even"><td><code>R/permissions.R</code></td>
<td>Permission system and tool annotations</td>
</tr><tr class="odd"><td><code>R/hooks.R</code></td>
<td>HookRegistry and event system</td>
</tr><tr class="even"><td><code>R/tools-builtin.R</code></td>
<td>Built-in tools implementation</td>
</tr><tr class="odd"><td><code>exec/deputy</code></td>
<td>CLI application using Rapp</td>
</tr><tr class="even"><td><code>tests/testthat/helper-mocks.R</code></td>
<td>Mock objects for testing</td>
</tr></tbody></table></div>
<div class="section level2">
<h2 id="dependencies">Dependencies<a class="anchor" aria-label="anchor" href="#dependencies"></a></h2>
<p><strong>Core</strong> (in Imports): - <code>ellmer</code> (&gt;= 0.3.0) - LLM abstraction layer - <code>R6</code> - Object-oriented programming - <code>cli</code> - CLI formatting - <code>rlang</code> - Language utilities - <code>coro</code> - Coroutines for streaming - <code>digest</code> - Hashing</p>
<p><strong>Development</strong> (in Suggests): - <code>testthat</code> (&gt;= 3.0.0) - Testing - <code>Rapp</code> - CLI framework - <code>knitr</code> - Vignettes</p>
</div>
<div class="section level2">
<h2 id="issue-tracking-with-beads">Issue Tracking with Beads<a class="anchor" aria-label="anchor" href="#issue-tracking-with-beads"></a></h2>
<p>This project uses <strong>bd</strong> (beads) for issue tracking. Issues are stored in <code>.beads/</code> and synced via git.</p>
<div class="section level3">
<h3 id="git-integration">Git Integration<a class="anchor" aria-label="anchor" href="#git-integration"></a></h3>
<p>Beads integrates with git via: - <strong>JSONL sync</strong>: Issues stored in <code>.beads/issues.jsonl</code> (git-tracked) - <strong>Merge driver</strong>: Intelligent JSONL conflict resolution (auto-configured) - <strong>Hooks</strong>: Auto-sync on git operations</p>
<p>Files that should be committed: <code>.beads/.gitignore</code>, <code>.gitattributes</code> Files that are gitignored: <code>.beads/beads.db</code>, daemon files</p>
</div>
<div class="section level3">
<h3 id="essential-commands">Essential Commands<a class="anchor" aria-label="anchor" href="#essential-commands"></a></h3>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co"># Finding work</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="ex">bd</span> ready                              <span class="co"># Show issues ready to work (no blockers)</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="ex">bd</span> list <span class="at">--status</span><span class="op">=</span>open                 <span class="co"># All open issues</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="ex">bd</span> show <span class="op">&lt;</span>id<span class="op">&gt;</span>                          <span class="co"># Detailed issue view with dependencies</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="co"># Working on issues</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="ex">bd</span> update <span class="op">&lt;</span>id<span class="op">&gt;</span> --status=in_progress   <span class="co"># Claim work</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="ex">bd</span> close <span class="op">&lt;</span>id<span class="op">&gt;</span>                         <span class="co"># Mark complete</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="ex">bd</span> close <span class="op">&lt;</span>id1<span class="op">&gt;</span> <span class="op">&lt;</span>id2<span class="op">&gt;</span> ...              <span class="co"># Close multiple issues</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="co"># Creating issues (always include description for context)</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="ex">bd</span> create <span class="st">"Fix bug"</span> <span class="at">--description</span><span class="op">=</span><span class="st">"Details here"</span> <span class="at">-t</span> bug <span class="at">-p</span> 1</span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a><span class="co"># Dependencies</span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a><span class="ex">bd</span> dep add <span class="op">&lt;</span>issue<span class="op">&gt;</span> <span class="op">&lt;</span>depends-on<span class="op">&gt;</span>       <span class="co"># Add dependency</span></span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a><span class="ex">bd</span> blocked                            <span class="co"># Show blocked issues</span></span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a><span class="ex">bd</span> dep tree <span class="op">&lt;</span>id<span class="op">&gt;</span>                      <span class="co"># View dependency tree</span></span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a><span class="co"># Sync</span></span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a><span class="ex">bd</span> sync                               <span class="co"># Sync with git remote</span></span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a><span class="ex">bd</span> sync <span class="at">--status</span>                      <span class="co"># Check sync status</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="when-to-use-beads-vs-todowrite">When to Use Beads vs TodoWrite<a class="anchor" aria-label="anchor" href="#when-to-use-beads-vs-todowrite"></a></h3>
<table class="table"><thead><tr class="header"><th>Use <strong>Beads (<code>bd</code>)</strong> for</th>
<th>Use <strong>TodoWrite</strong> for</th>
</tr></thead><tbody><tr class="odd"><td>Multi-session work</td>
<td>Single-session execution</td>
</tr><tr class="even"><td>Work with dependencies</td>
<td>Simple task checklists</td>
</tr><tr class="odd"><td>Discovered work needing tracking</td>
<td>Immediate step-by-step tasks</td>
</tr><tr class="even"><td>Collaborative/handed-off work</td>
<td>Personal progress tracking</td>
</tr></tbody></table><p>When in doubt, prefer beads—persistence you don’t need beats lost context.</p>
</div>
</div>
<div class="section level2">
<h2 id="feature-branch--pr-workflow">Feature Branch + PR Workflow<a class="anchor" aria-label="anchor" href="#feature-branch--pr-workflow"></a></h2>
<blockquote>
<p><strong>⚠️ All changes must go through Pull Requests.</strong> Never commit directly to main. Create a feature branch, make your changes, and open a PR for review.</p>
</blockquote>
<div class="section level3">
<h3 id="before-creating-a-pr">Before Creating a PR<a class="anchor" aria-label="anchor" href="#before-creating-a-pr"></a></h3>
<p><strong>IMPORTANT</strong>: Review and update CLAUDE.md if your changes affect: - New directories or files that should be documented - New code conventions or patterns - New commands or workflows - Changes to architecture or dependencies</p>
</div>
<div class="section level3">
<h3 id="id_1-find-work-and-create-feature-branch">1. Find Work and Create Feature Branch<a class="anchor" aria-label="anchor" href="#id_1-find-work-and-create-feature-branch"></a></h3>
<p><strong>⚠️ IMPORTANT: Create the feature branch BEFORE claiming the issue or writing any code.</strong></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">bd</span> ready                              <span class="co"># Find available work</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="ex">bd</span> show <span class="op">&lt;</span>id<span class="op">&gt;</span>                          <span class="co"># Review issue details</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="co"># CREATE BRANCH FIRST - before any code changes!</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="fu">git</span> checkout <span class="at">-b</span> feature/<span class="op">&lt;</span>short-description<span class="op">&gt;</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="co"># or: git checkout -b fix/&lt;short-description&gt;</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="ex">bd</span> update <span class="op">&lt;</span>id<span class="op">&gt;</span> --status=in_progress   <span class="co"># Now claim the work</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_2-work-and-sync">2. Work and Sync<a class="anchor" aria-label="anchor" href="#id_2-work-and-sync"></a></h3>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co"># Make changes...</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="ex">bd</span> sync                               <span class="co"># Sync beads periodically</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_3-run-quality-gates">3. Run Quality Gates<a class="anchor" aria-label="anchor" href="#id_3-run-quality-gates"></a></h3>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co"># Format ALL code with air (R/ and tests/)</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="ex">air</span> format R/ tests/testthat/</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="co"># Lint with jarl</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="ex">jarl</span> check R/</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="co"># Run tests</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"devtools::test()"</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a><span class="co"># Run R CMD check</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"devtools::check()"</span></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a><span class="co"># Build pkgdown site</span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"devtools::document(); pkgdown::build_site(preview = FALSE)"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_4-create-pr-and-close-issue">4. Create PR and Close Issue<a class="anchor" aria-label="anchor" href="#id_4-create-pr-and-close-issue"></a></h3>
<p>When code is complete and ready for review:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="fu">git</span> add .</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="fu">git</span> commit <span class="at">-m</span> <span class="st">"feat: description (deputy-xxx)"</span>  <span class="co"># Include beads issue ID!</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="ex">bd</span> close <span class="op">&lt;</span>id<span class="op">&gt;</span>                         <span class="co"># Close beads issue - work is done</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="ex">bd</span> sync</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="fu">git</span> push <span class="at">-u</span> origin HEAD</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="ex">gh</span> pr create <span class="at">--title</span> <span class="st">"..."</span> <span class="at">--body</span> <span class="st">"Resolves deputy-XXX"</span></span></code></pre></div>
<p><strong>Important</strong>: Close the beads issue when the <em>work</em> is complete, not when the PR is merged. The issue tracks your work; the PR tracks the review/merge process.</p>
</div>
<div class="section level3">
<h3 id="id_5-human-reviews-and-merges-pr">5. Human Reviews and Merges PR<a class="anchor" aria-label="anchor" href="#id_5-human-reviews-and-merges-pr"></a></h3>
<p>Agents create PRs but <strong>do not merge them</strong>. Humans review and merge PRs to main.</p>
</div>
<div class="section level3">
<h3 id="id_6-after-pr-merged-cleanup">6. After PR Merged (Cleanup)<a class="anchor" aria-label="anchor" href="#id_6-after-pr-merged-cleanup"></a></h3>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="fu">git</span> checkout main</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="fu">git</span> pull</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="fu">git</span> branch <span class="at">-d</span> feature/<span class="op">&lt;</span>short-description<span class="op">&gt;</span></span></code></pre></div>
<p>Or use:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">pr_finish</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="session-completion-protocol">Session Completion Protocol<a class="anchor" aria-label="anchor" href="#session-completion-protocol"></a></h2>
<p><strong>CRITICAL</strong>: Before ending a session, complete ALL steps. Work is NOT complete until <code>git push</code> succeeds.</p>
<div class="section level3">
<h3 id="mandatory-checklist-feature-branch-workflow">Mandatory Checklist (Feature Branch Workflow)<a class="anchor" aria-label="anchor" href="#mandatory-checklist-feature-branch-workflow"></a></h3>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="co"># 1. Verify you're on a feature branch (NOT main!)</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="fu">git</span> branch <span class="at">--show-current</span>  <span class="co"># Should NOT be 'main'</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="co"># 2. File issues for remaining work</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="ex">bd</span> create <span class="st">"Follow-up task"</span> <span class="at">--description</span><span class="op">=</span><span class="st">"..."</span> <span class="at">-t</span> task <span class="at">-p</span> 2</span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a><span class="co"># 3. Run quality gates (if code changed)</span></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a><span class="ex">air</span> format R/ tests/testthat/</span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a><span class="ex">jarl</span> check R/</span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"devtools::check()"</span></span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a><span class="co"># 4. Update issue status</span></span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a><span class="ex">bd</span> close <span class="op">&lt;</span>completed-issues<span class="op">&gt;</span>           <span class="co"># Include reason if helpful</span></span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a><span class="ex">bd</span> update <span class="op">&lt;</span>in-progress-issues<span class="op">&gt;</span> --status=open  <span class="co"># If not finished</span></span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a></span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a><span class="co"># 5. Commit with beads issue ID</span></span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a><span class="fu">git</span> add .</span>
<span id="cb17-18"><a href="#cb17-18" tabindex="-1"></a><span class="fu">git</span> commit <span class="at">-m</span> <span class="st">"feat: description (deputy-xxx)"</span>  <span class="co"># Always include issue ID!</span></span>
<span id="cb17-19"><a href="#cb17-19" tabindex="-1"></a><span class="ex">bd</span> sync</span>
<span id="cb17-20"><a href="#cb17-20" tabindex="-1"></a><span class="fu">git</span> push <span class="at">-u</span> origin HEAD</span>
<span id="cb17-21"><a href="#cb17-21" tabindex="-1"></a></span>
<span id="cb17-22"><a href="#cb17-22" tabindex="-1"></a><span class="co"># 6. Create PR (if not already created)</span></span>
<span id="cb17-23"><a href="#cb17-23" tabindex="-1"></a><span class="ex">gh</span> pr create <span class="at">--title</span> <span class="st">"..."</span> <span class="at">--body</span> <span class="st">"Resolves deputy-xxx"</span></span>
<span id="cb17-24"><a href="#cb17-24" tabindex="-1"></a></span>
<span id="cb17-25"><a href="#cb17-25" tabindex="-1"></a><span class="co"># 7. Verify</span></span>
<span id="cb17-26"><a href="#cb17-26" tabindex="-1"></a><span class="fu">git</span> status  <span class="co"># Should show "up to date with origin"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="critical-rules">Critical Rules<a class="anchor" aria-label="anchor" href="#critical-rules"></a></h3>
<ul><li>
<strong>NEVER commit directly to main</strong> - always use feature branches</li>
<li>Work is NOT complete until <code>git push</code> succeeds</li>
<li>NEVER stop before pushing—that leaves work stranded locally</li>
<li>NEVER say “ready to push when you are”—YOU must push</li>
<li>If push fails, resolve and retry until it succeeds</li>
<li>Always run <code>bd sync</code> before ending session</li>
<li>Always include beads issue ID in commit messages (enables <code>bd doctor</code> to detect orphans)</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="parallel-sessions--worktrees">Parallel Sessions &amp; Worktrees<a class="anchor" aria-label="anchor" href="#parallel-sessions--worktrees"></a></h2>
<p>This project supports parallel work via git worktrees. The beads daemon commits changes to a dedicated branch, preventing conflicts when multiple Claude sessions run simultaneously.</p>
<div class="section level3">
<h3 id="creating-worktrees-for-parallel-features">Creating Worktrees for Parallel Features<a class="anchor" aria-label="anchor" href="#creating-worktrees-for-parallel-features"></a></h3>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="co"># From main repo, create worktree for a feature</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="fu">git</span> worktree add ../deputy-feature-x <span class="at">-b</span> feature/feature-x</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a><span class="bu">cd</span> ../deputy-feature-x</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a><span class="co"># Beads commands work normally - shared database, safe daemon</span></span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a><span class="ex">bd</span> ready</span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a><span class="ex">bd</span> create <span class="st">"Implement feature"</span> <span class="at">-t</span> task <span class="at">-p</span> 2</span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a><span class="ex">bd</span> sync</span></code></pre></div>
<p>All worktrees share the same <code>.beads</code> database in the main repo. Changes are immediately visible across sessions.</p>
</div>
<div class="section level3">
<h3 id="cleanup-after-pr-merged">Cleanup After PR Merged<a class="anchor" aria-label="anchor" href="#cleanup-after-pr-merged"></a></h3>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="fu">git</span> worktree remove ../deputy-feature-x</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="fu">git</span> worktree prune</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="troubleshooting-branch-already-checked-out">Troubleshooting: “Branch already checked out”<a class="anchor" aria-label="anchor" href="#troubleshooting-branch-already-checked-out"></a></h3>
<p>If git says a branch is checked out in a beads worktree:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-rf</span> .git/beads-worktrees</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="fu">git</span> worktree prune</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="cicd">CI/CD<a class="anchor" aria-label="anchor" href="#cicd"></a></h2>
<p>GitHub Actions workflows in <code>.github/workflows/</code>: - <code>R-CMD-check.yaml</code> - Package check on multiple platforms - <code>test-coverage.yaml</code> - Code coverage to codecov - <code>pkgdown.yaml</code> - Documentation site - <code>format-suggest.yaml</code> - Code formatting suggestions - <code>claude.yml</code> / <code>claude-code-review.yml</code> - Claude integration</p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by James Wade.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

