<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Permissions and Safety • deputy</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Permissions and Safety">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">deputy</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/getting-started.html">Getting Started</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/tools.html">Tools and Tool Bundles</a></li>
    <li><a class="dropdown-item" href="../articles/permissions.html">Permissions and Safety</a></li>
    <li><a class="dropdown-item" href="../articles/hooks.html">Hooks</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/multi-agent.html">Multi-Agent Orchestration</a></li>
    <li><a class="dropdown-item" href="../articles/structured-output.html">Structured Output</a></li>
    <li><a class="dropdown-item" href="../articles/agent-configuration.html">Agent Configuration</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Examples</h6></li>
    <li><a class="dropdown-item" href="../articles/example-data-analysis.html">Data Analysis Agent</a></li>
    <li><a class="dropdown-item" href="../articles/example-extraction-pipeline.html">Extraction Pipeline</a></li>
    <li><a class="dropdown-item" href="../articles/example-code-review.html">Code Review (Multi-Agent)</a></li>
    <li><a class="dropdown-item" href="../articles/example-shiny-chat.html">Shiny Chat</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/JamesHWade/deputy/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Permissions and Safety</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/JamesHWade/deputy/blob/main/vignettes/permissions.Rmd" class="external-link"><code>vignettes/permissions.Rmd</code></a></small>
      <div class="d-none name"><code>permissions.Rmd</code></div>
    </div>

    
    
<p>Permissions control what an agent is allowed to do. They sit between
the LLM and tool execution, checking every tool call before it runs.
deputy ships with sensible presets and makes it easy to build custom
policies.</p>
<div class="section level2">
<h2 id="permission-presets">Permission Presets<a class="anchor" aria-label="anchor" href="#permission-presets"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/JamesHWade/deputy" class="external-link">deputy</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Read-only: only read_file and list_files are allowed</span></span>
<span><span class="fu"><a href="../reference/permissions_readonly.html">permissions_readonly</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Standard (default): file read/write in working dir, R code, no bash/web</span></span>
<span><span class="fu"><a href="../reference/permissions_standard.html">permissions_standard</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Full: everything allowed (use with caution!)</span></span>
<span><span class="fu"><a href="../reference/permissions_full.html">permissions_full</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Each preset returns a <code>Permissions</code> object. Pass it to
<code>Agent$new()</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">agent</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Agent.html">Agent</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  chat <span class="op">=</span> <span class="fu">ellmer</span><span class="fu">::</span><span class="fu"><a href="https://ellmer.tidyverse.org/reference/chat_anthropic.html" class="external-link">chat_anthropic</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  tools <span class="op">=</span> <span class="fu"><a href="../reference/tools_all.html">tools_all</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  permissions <span class="op">=</span> <span class="fu"><a href="../reference/permissions_readonly.html">permissions_readonly</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="custom-permissions">Custom Permissions<a class="anchor" aria-label="anchor" href="#custom-permissions"></a>
</h2>
<p>For fine-grained control, create a <code>Permissions</code> object
directly:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">perms</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Permissions.html">Permissions</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  file_read <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  file_write <span class="op">=</span> <span class="st">"/path/to/allowed/dir"</span>,</span>
<span>  bash <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  r_code <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  web <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  install_packages <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  max_turns <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  max_cost_usd <span class="op">=</span> <span class="fl">0.50</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Fields:</p>
<table class="table">
<colgroup>
<col width="26%">
<col width="23%">
<col width="50%">
</colgroup>
<thead><tr class="header">
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>file_read</code></td>
<td>logical</td>
<td>Allow reading files</td>
</tr>
<tr class="even">
<td><code>file_write</code></td>
<td>logical / path</td>
<td>Allow writing (optionally restricted to a directory)</td>
</tr>
<tr class="odd">
<td><code>bash</code></td>
<td>logical</td>
<td>Allow bash commands</td>
</tr>
<tr class="even">
<td><code>r_code</code></td>
<td>logical</td>
<td>Allow R code execution</td>
</tr>
<tr class="odd">
<td><code>web</code></td>
<td>logical</td>
<td>Allow web access</td>
</tr>
<tr class="even">
<td><code>install_packages</code></td>
<td>logical</td>
<td>Allow package installation</td>
</tr>
<tr class="odd">
<td><code>max_turns</code></td>
<td>integer</td>
<td>Maximum agentic turns (default 25)</td>
</tr>
<tr class="even">
<td><code>max_cost_usd</code></td>
<td>numeric / NULL</td>
<td>Maximum spend in USD</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="permission-modes">Permission Modes<a class="anchor" aria-label="anchor" href="#permission-modes"></a>
</h2>
<p>The <code>mode</code> field provides broad policy shortcuts:</p>
<table class="table">
<thead><tr class="header">
<th>Mode</th>
<th>Behaviour</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>"default"</code></td>
<td>Check each tool against the policy fields above</td>
</tr>
<tr class="even">
<td><code>"readonly"</code></td>
<td>Only allow tools annotated as
<code>read_only_hint = TRUE</code>
</td>
</tr>
<tr class="odd">
<td><code>"acceptEdits"</code></td>
<td>Auto-approve file writes without prompting</td>
</tr>
<tr class="even">
<td><code>"bypassPermissions"</code></td>
<td>Allow everything (dangerous!)</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">perms</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Permissions.html">Permissions</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"readonly"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="tool-annotations">Tool Annotations<a class="anchor" aria-label="anchor" href="#tool-annotations"></a>
</h2>
<p>Tools carry annotations that describe their behaviour. The permission
system uses these annotations to make decisions:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># A read-only tool</span></span>
<span><span class="va">tool_safe</span> <span class="op">&lt;-</span> <span class="fu">ellmer</span><span class="fu">::</span><span class="fu"><a href="https://ellmer.tidyverse.org/reference/tool.html" class="external-link">tool</a></span><span class="op">(</span></span>
<span>  fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"safe_tool"</span>,</span>
<span>  description <span class="op">=</span> <span class="st">"A safe, read-only tool"</span>,</span>
<span>  arguments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu">ellmer</span><span class="fu">::</span><span class="fu"><a href="https://ellmer.tidyverse.org/reference/type_boolean.html" class="external-link">type_string</a></span><span class="op">(</span><span class="st">"Input"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  annotations <span class="op">=</span> <span class="fu">ellmer</span><span class="fu">::</span><span class="fu"><a href="https://ellmer.tidyverse.org/reference/tool_annotations.html" class="external-link">tool_annotations</a></span><span class="op">(</span></span>
<span>    read_only_hint <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    destructive_hint <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>In <code>"readonly"</code> mode, only tools with
<code>read_only_hint = TRUE</code> are allowed. In
<code>"default"</code> mode, tools with
<code>destructive_hint = TRUE</code> may be blocked depending on the
policy.</p>
</div>
<div class="section level2">
<h2 id="custom-permission-callbacks">Custom Permission Callbacks<a class="anchor" aria-label="anchor" href="#custom-permission-callbacks"></a>
</h2>
<p>For complex logic, provide a <code>can_use_tool</code> callback:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">perms</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Permissions.html">Permissions</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  can_use_tool <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">tool_name</span>, <span class="va">tool_input</span>, <span class="va">context</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Block writes to sensitive files</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">tool_name</span> <span class="op">==</span> <span class="st">"write_file"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^\\.env|secrets|credentials"</span>, <span class="va">tool_input</span><span class="op">$</span><span class="va">path</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="../reference/PermissionResultDeny.html">PermissionResultDeny</a></span><span class="op">(</span></span>
<span>          reason <span class="op">=</span> <span class="st">"Cannot write to sensitive files"</span></span>
<span>        <span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="fu"><a href="../reference/PermissionResultAllow.html">PermissionResultAllow</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The callback receives:</p>
<ul>
<li>
<code>tool_name</code> – Name of the tool being called</li>
<li>
<code>tool_input</code> – Named list of arguments</li>
<li>
<code>context</code> – List with <code>working_dir</code> and
<code>tool_annotations</code>
</li>
</ul>
<p>It must return <code><a href="../reference/PermissionResultAllow.html">PermissionResultAllow()</a></code> or
<code>PermissionResultDeny(reason)</code>.</p>
</div>
<div class="section level2">
<h2 id="example-read-only-agent">Example: Read-Only Agent<a class="anchor" aria-label="anchor" href="#example-read-only-agent"></a>
</h2>
<p>A read-only agent can explore files but cannot change anything:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/JamesHWade/deputy" class="external-link">deputy</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">chat</span> <span class="op">&lt;-</span> <span class="fu">ellmer</span><span class="fu">::</span><span class="fu"><a href="https://ellmer.tidyverse.org/reference/chat_anthropic.html" class="external-link">chat_anthropic</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"claude-sonnet-4-20250514"</span><span class="op">)</span></span>
<span><span class="va">agent</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Agent.html">Agent</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  chat <span class="op">=</span> <span class="va">chat</span>,</span>
<span>  tools <span class="op">=</span> <span class="fu"><a href="../reference/tools_file.html">tools_file</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  permissions <span class="op">=</span> <span class="fu"><a href="../reference/permissions_readonly.html">permissions_readonly</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="va">agent</span><span class="op">$</span><span class="fu">run_sync</span><span class="op">(</span><span class="st">"What files are in the current directory?"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">response</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="cost-and-turn-limits">Cost and Turn Limits<a class="anchor" aria-label="anchor" href="#cost-and-turn-limits"></a>
</h2>
<p>Permissions also enforce resource limits:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">perms</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Permissions.html">Permissions</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  max_turns <span class="op">=</span> <span class="fl">10</span>,      <span class="co"># Stop after 10 agentic turns</span></span>
<span>  max_cost_usd <span class="op">=</span> <span class="fl">1.00</span>  <span class="co"># Stop if cost exceeds $1.00</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>When a limit is reached, the agent stops and the
<code>AgentResult$stop_reason</code> indicates what happened
(<code>"max_turns"</code> or <code>"cost_limit"</code>).</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by James Wade.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
