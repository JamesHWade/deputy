# deputy

deputy is an R implementation of [Anthropic’s Claude Agent
SDK](https://github.com/anthropics/claude-code/tree/main/agent-sdk),
built on [ellmer](https://ellmer.tidyverse.org/). It enables you to
create AI agents that can use tools to accomplish multi-step tasks, with
built-in support for permissions, hooks, and streaming output.

> **Note:** This package aims to bring the patterns and capabilities of
> the Claude Agent SDK to the R ecosystem. While inspired by Anthropic’s
> SDK, deputy is provider-agnostic and works with any LLM that ellmer
> supports.

## Features

- **Provider-agnostic** - Works with OpenAI, Anthropic, Google, Ollama,
  and any provider ellmer supports
- **Tool bundles** - Pre-built tools for file operations, code
  execution, and data analysis
- **Permission system** - Fine-grained control over what agents can do
- **Hooks** - Intercept and customize agent behavior at key points
- **Streaming output** - Real-time feedback as agents work
- **Multi-agent** - Coordinate specialized sub-agents for complex tasks
- **Session persistence** - Save and restore agent conversations

## Installation

You can install the development version of deputy from GitHub:

``` r
# install.packages("pak")
pak::pak("JamesHWade/deputy")
```

You’ll also need ellmer:

``` r
pak::pak("tidyverse/ellmer")
```

## Quick Start

### Create an Agent

``` r
library(deputy)

# Create an agent with file tools
agent <- Agent$new(
  chat = ellmer::chat("openai"),
  tools = tools_file()
)

# Run a task (blocking)
result <- agent$run_sync("What R files are in the current directory?")
cat(result$response)
```

### Streaming Output

For real-time feedback as the agent works:

``` r
for (event in agent$run("Analyze the structure of this project")) {
  switch(
    event$type,
    "text" = cat(event$text),
    "tool_start" = message("Calling ", event$tool_name, "..."),
    "stop" = message("\nDone! Cost: $", round(event$cost$total, 4))
  )
}
```

### Tools

deputy provides tool presets for common use cases:

``` r
# Use presets for quick setup
tools_preset("minimal")   # read_file, list_files
tools_preset("standard")  # + write_file, run_r_code
tools_preset("dev")       # + run_bash (full development)
tools_preset("data")      # read_file, list_files, read_csv, run_r_code
tools_preset("full")      # all tools

# Or use individual bundles
tools_file()  # File operations
tools_code()  # Code execution
tools_data()  # Data reading
tools_all()   # Everything

# List available presets
list_presets()
```

### Permissions

Control what your agent can do:

``` r
# Read-only: no writes, no code execution
agent <- Agent$new(
  chat = ellmer::chat("openai"),
  tools = tools_file(),
  permissions = permissions_readonly()
)

# Standard: file read/write in working dir, R code, no bash
agent <- Agent$new(
  chat = ellmer::chat("openai"),
  tools = tools_file(),
  permissions = permissions_standard()
)

# Custom permissions with limits
agent <- Agent$new(
  chat = ellmer::chat("openai"),
  tools = tools_all(),
  permissions = Permissions$new(
    file_write = getwd(),
    bash = FALSE,
    r_code = TRUE,
    max_turns = 10,
    max_cost_usd = 0.50
  )
)
```

### Hooks

Intercept agent behavior:

``` r
# Log all tool calls
agent$add_hook(HookMatcher$new(
  event = "PostToolUse",
  callback = function(tool_name, tool_result, context) {
    message("[", Sys.time(), "] ", tool_name)
    HookResultPostToolUse()
  }
))

# Block dangerous bash commands
agent$add_hook(HookMatcher$new(
  event = "PreToolUse",
  pattern = "^run_bash$",
  callback = function(tool_name, tool_input, context) {
    if (grepl("rm -rf|sudo", tool_input$command)) {
      HookResultPreToolUse(permission = "deny", reason = "Dangerous command")
    } else {
      HookResultPreToolUse(permission = "allow")
    }
  }
))

# Track session lifecycle for metrics/logging
agent$add_hook(HookMatcher$new(
  event = "SessionStart",
  callback = function(context) {
    message("Session started with ", context$tools_count, " tools")
    HookResultSessionStart()
  }
))

agent$add_hook(HookMatcher$new(
  event = "SessionEnd",
  callback = function(reason, context) {
    message("Session ended: ", reason, " after ", context$total_turns, " turns")
    HookResultSessionEnd()
  }
))
```

### Error Handling

deputy provides structured error types for programmatic error handling:

``` r
# Catch specific error types
tryCatch(
  agent$run_sync("task"),
  deputy_budget_exceeded = function(e) {
    message("Budget exceeded: $", e$current_cost, " > $", e$max_cost)
  },
  deputy_session_load = function(e) {
    message("Failed to load session from: ", e$path)
  },
  deputy_error = function(e) {
    message("Deputy error: ", conditionMessage(e))
  }
)
```

### Multi-Agent Systems

Coordinate specialized agents:

``` r
# Define sub-agents
code_agent <- agent_definition(
  name = "code_analyst",
  description = "Analyzes R code",
  prompt = "You are an expert R programmer.",
  tools = tools_file()
)

# Create lead agent that can delegate
lead <- LeadAgent$new(
  chat = ellmer::chat("openai"),
  sub_agents = list(code_agent)
)

result <- lead$run_sync("Review the R code in this project")
```

## Provider Support

deputy works with any LLM provider that ellmer supports:

``` r
# OpenAI
Agent$new(chat = ellmer::chat("openai"))

# Anthropic
Agent$new(chat = ellmer::chat("anthropic"))

# Google
Agent$new(chat = ellmer::chat("google_gemini"))

# Local via Ollama
Agent$new(chat = ellmer::chat("ollama/llama3.2"))
```

## Learn More

- [`vignette("getting-started")`](https://jameshwade.github.io/deputy/articles/getting-started.md) -
  Comprehensive introduction
- [ellmer documentation](https://ellmer.tidyverse.org/) - Underlying LLM
  framework

## License

MIT

# Package index

## Agent

Core agent class for agentic AI workflows

- [`Agent`](https://jameshwade.github.io/deputy/reference/Agent.md) :
  Agent R6 Class
- [`AgentResult`](https://jameshwade.github.io/deputy/reference/AgentResult.md)
  : Agent Result R6 Class
- [`AgentEvent()`](https://jameshwade.github.io/deputy/reference/AgentEvent.md)
  : Create an agent event

## Tools

Built-in tools and tool bundles

- [`tool_ask_user()`](https://jameshwade.github.io/deputy/reference/tool_ask_user.md)
  : AskUserQuestion tool
- [`tool_list_files()`](https://jameshwade.github.io/deputy/reference/tool_list_files.md)
  : List files in a directory
- [`tool_read_csv()`](https://jameshwade.github.io/deputy/reference/tool_read_csv.md)
  : Read a CSV file
- [`tool_read_file()`](https://jameshwade.github.io/deputy/reference/tool_read_file.md)
  : Read file contents
- [`tool_run_bash()`](https://jameshwade.github.io/deputy/reference/tool_run_bash.md)
  : Execute bash commands
- [`tool_run_r_code()`](https://jameshwade.github.io/deputy/reference/tool_run_r_code.md)
  : Execute R code
- [`tool_write_file()`](https://jameshwade.github.io/deputy/reference/tool_write_file.md)
  : Write content to a file
- [`tools_all()`](https://jameshwade.github.io/deputy/reference/tools_all.md)
  : All built-in tools
- [`tools_code()`](https://jameshwade.github.io/deputy/reference/tools_code.md)
  : Code execution tools
- [`tools_data()`](https://jameshwade.github.io/deputy/reference/tools_data.md)
  : Data reading tools
- [`tools_file()`](https://jameshwade.github.io/deputy/reference/tools_file.md)
  : File operation tools
- [`tools_interactive()`](https://jameshwade.github.io/deputy/reference/tools_interactive.md)
  : Tools for interactive workflows
- [`tools_mcp()`](https://jameshwade.github.io/deputy/reference/tools_mcp.md)
  : Get tools from MCP servers
- [`tools_preset()`](https://jameshwade.github.io/deputy/reference/tools_preset.md)
  : Get a tool preset by name
- [`ToolPresets`](https://jameshwade.github.io/deputy/reference/ToolPresets.md)
  : Available tool preset names
- [`list_presets()`](https://jameshwade.github.io/deputy/reference/list_presets.md)
  : List available tool presets
- [`set_ask_user_callback()`](https://jameshwade.github.io/deputy/reference/set_ask_user_callback.md)
  : Set callback for non-interactive user input

## MCP Integration

Model Context Protocol server support

- [`mcp_available()`](https://jameshwade.github.io/deputy/reference/mcp_available.md)
  : Check if MCP support is available
- [`mcp_servers()`](https://jameshwade.github.io/deputy/reference/mcp_servers.md)
  : List available MCP servers

## Permissions

Control what agents can do

- [`Permissions`](https://jameshwade.github.io/deputy/reference/Permissions.md)
  : Permissions R6 Class
- [`PermissionMode`](https://jameshwade.github.io/deputy/reference/PermissionMode.md)
  : Permission modes for agent tool access
- [`PermissionResultAllow()`](https://jameshwade.github.io/deputy/reference/PermissionResultAllow.md)
  : Create an allow permission result
- [`PermissionResultDeny()`](https://jameshwade.github.io/deputy/reference/PermissionResultDeny.md)
  : Create a deny permission result
- [`permissions_full()`](https://jameshwade.github.io/deputy/reference/permissions_full.md)
  : Create a full access permission policy
- [`permissions_readonly()`](https://jameshwade.github.io/deputy/reference/permissions_readonly.md)
  : Create a read-only permission policy
- [`permissions_standard()`](https://jameshwade.github.io/deputy/reference/permissions_standard.md)
  : Create a standard permission policy

## Hooks

Intercept and customize agent behavior

- [`HookMatcher`](https://jameshwade.github.io/deputy/reference/HookMatcher.md)
  : HookMatcher R6 Class
- [`HookRegistry`](https://jameshwade.github.io/deputy/reference/HookRegistry.md)
  : HookRegistry R6 Class
- [`HookEvent`](https://jameshwade.github.io/deputy/reference/HookEvent.md)
  : Hook events supported by deputy
- [`HookResultPostToolUse()`](https://jameshwade.github.io/deputy/reference/HookResultPostToolUse.md)
  : Create a PostToolUse hook result
- [`HookResultPreCompact()`](https://jameshwade.github.io/deputy/reference/HookResultPreCompact.md)
  : Create a PreCompact hook result
- [`HookResultPreToolUse()`](https://jameshwade.github.io/deputy/reference/HookResultPreToolUse.md)
  : Create a PreToolUse hook result
- [`HookResultSessionEnd()`](https://jameshwade.github.io/deputy/reference/HookResultSessionEnd.md)
  : Create a SessionEnd hook result
- [`HookResultSessionStart()`](https://jameshwade.github.io/deputy/reference/HookResultSessionStart.md)
  : Create a SessionStart hook result
- [`HookResultStop()`](https://jameshwade.github.io/deputy/reference/HookResultStop.md)
  : Create a Stop hook result
- [`HookResultSubagentStop()`](https://jameshwade.github.io/deputy/reference/HookResultSubagentStop.md)
  : Create a SubagentStop hook result
- [`hook_block_dangerous_bash()`](https://jameshwade.github.io/deputy/reference/hook_block_dangerous_bash.md)
  : Create a hook that blocks dangerous bash commands
- [`hook_limit_file_writes()`](https://jameshwade.github.io/deputy/reference/hook_limit_file_writes.md)
  : Create a hook that limits file writes to a directory
- [`hook_log_tools()`](https://jameshwade.github.io/deputy/reference/hook_log_tools.md)
  : Create a hook that logs all tool calls

## Skills

Extend agents with specialized capabilities

- [`Skill`](https://jameshwade.github.io/deputy/reference/Skill.md) :
  Skill R6 Class
- [`skill_load()`](https://jameshwade.github.io/deputy/reference/skill_load.md)
  : Load a skill from a directory
- [`skill_create()`](https://jameshwade.github.io/deputy/reference/skill_create.md)
  : Create a skill programmatically
- [`skills_list()`](https://jameshwade.github.io/deputy/reference/skills_list.md)
  : List available skills in a directory

## Multi-Agent

Coordinate multiple specialized agents

- [`LeadAgent`](https://jameshwade.github.io/deputy/reference/LeadAgent.md)
  : LeadAgent R6 Class
- [`agent_definition()`](https://jameshwade.github.io/deputy/reference/agent_definition.md)
  : Create an Agent Definition
- [`agent_with_delegation()`](https://jameshwade.github.io/deputy/reference/agent_with_delegation.md)
  : Create a simple delegation agent

## Errors

Error classes and constructors

- [`deputy-errors`](https://jameshwade.github.io/deputy/reference/deputy-errors.md)
  [`DeputyError`](https://jameshwade.github.io/deputy/reference/deputy-errors.md)
  : Deputy Error Classes
- [`is_deputy_error()`](https://jameshwade.github.io/deputy/reference/is_deputy_error.md)
  : Check if an object is a deputy error
- [`abort_budget_exceeded()`](https://jameshwade.github.io/deputy/reference/abort_budget_exceeded.md)
  : Abort with a budget exceeded error
- [`abort_deputy()`](https://jameshwade.github.io/deputy/reference/abort_deputy.md)
  : Abort with a structured deputy error
- [`abort_hook()`](https://jameshwade.github.io/deputy/reference/abort_hook.md)
  : Abort with a hook error
- [`abort_permission_denied()`](https://jameshwade.github.io/deputy/reference/abort_permission_denied.md)
  : Abort with a permission denied error
- [`abort_provider()`](https://jameshwade.github.io/deputy/reference/abort_provider.md)
  : Abort with a provider error
- [`abort_session_load()`](https://jameshwade.github.io/deputy/reference/abort_session_load.md)
  : Abort with a session load error
- [`abort_session_save()`](https://jameshwade.github.io/deputy/reference/abort_session_save.md)
  : Abort with a session save error
- [`abort_tool_execution()`](https://jameshwade.github.io/deputy/reference/abort_tool_execution.md)
  : Abort with a tool execution error
- [`abort_turn_limit()`](https://jameshwade.github.io/deputy/reference/abort_turn_limit.md)
  : Abort with a turn limit error

# Articles

### Getting Started

- [Getting Started with
  deputy](https://jameshwade.github.io/deputy/articles/getting-started.md):
