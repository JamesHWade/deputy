---
title: "Getting Started with deputy"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Getting Started with deputy}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  eval = deputy:::eval_vignette()
)
vcr::setup_knitr()
```

deputy is an agentic AI framework for R that builds on
[ellmer](https://ellmer.tidyverse.org/). It enables you to create AI agents
that use tools to accomplish multi-step tasks, with built-in support for
permissions, hooks, and streaming output.

## Installation

```{r, eval = FALSE}
# Install from GitHub
pak::pak("JamesHWade/deputy")
```

## Quick Start

An agent wraps an ellmer chat object and gives it tools, permissions, and
lifecycle hooks:

```{r getting-started-quickstart, cassette = TRUE}
library(deputy)

chat <- ellmer::chat_anthropic(model = "claude-sonnet-4-20250514")
agent <- Agent$new(chat = chat, tools = tools_file())

result <- agent$run_sync("List the files in the current directory")
cat(result$response)
```

The agent sends your task to the LLM, which may call tools, and loops until
the task is complete. `run_sync()` blocks until done and returns an
`AgentResult`.

## Tool Bundles

deputy organises built-in tools into bundles you can mix and match:

| Bundle | Tools | Purpose |
|--------|-------|---------|
| `tools_file()` | `read_file`, `write_file`, `list_files` | File operations |
| `tools_code()` | `run_r_code`, `run_bash` | Code execution |
| `tools_data()` | `read_csv`, `read_file` | Data reading |
| `tools_web()` | `web_fetch`, `web_search` | Web access |
| `tools_all()` | All of the above | Everything |

```{r, eval = FALSE}
# Combine bundles
agent <- Agent$new(
  chat = ellmer::chat_anthropic(),
  tools = c(tools_file(), tools_code())
)
```

There are also named presets available via `tools_preset()`:

```{r, eval = FALSE}
list_presets()
tools_preset("dev")
```

See `vignette("tools")` for custom tools, web tools, MCP integration, and
human-in-the-loop.

## Streaming

For real-time feedback, use `run()` which returns a generator:

```{r getting-started-streaming, eval = FALSE}
chat <- ellmer::chat_anthropic(model = "claude-sonnet-4-20250514")
agent <- Agent$new(chat = chat, tools = tools_file())

for (event in agent$run("What is the name of this package?")) {
  switch(event$type,
    "text" = cat(event$text),
    "tool_start" = cli::cli_alert_info("Calling {event$tool_name}..."),
    "tool_end" = cli::cli_alert_success("Done"),
    "stop" = cli::cli_alert("Finished!")
  )
}
```

Events stream as they happen -- you see text tokens arrive, tool calls start
and finish, and a final stop event.

## Next Steps

- `vignette("tools")` -- Custom tools, web tools, MCP, and human-in-the-loop
- `vignette("permissions")` -- Permission presets, modes, and custom policies
- `vignette("hooks")` -- Lifecycle hooks for logging, blocking, and auditing
- `vignette("multi-agent")` -- Multi-agent delegation with LeadAgent
- `vignette("structured-output")` -- JSON schema output and validation
- `vignette("agent-configuration")` -- Settings, skills, sessions, and AgentResult
